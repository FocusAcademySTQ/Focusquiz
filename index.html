<!DOCTYPE html>
<html lang="ca">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Focus Academy ¬∑ Matem√†tiques</title>
  <meta name="description" content="Pr√†ctiques de matem√†tiques tipus ThatQuiz per a estudiants. Single-file, sense depend√®ncies." />
  <meta name="theme-color" content="#7aa2ff" />
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <noscript>
    <div style="background:#fee2e2;color:#7f1d1d;padding:10px 16px;text-align:center;border-bottom:1px solid #fecaca">
      Aquesta aplicaci√≥ necessita JavaScript per funcionar correctament.
    </div>
  </noscript>

  <header>
    <div class="wrap row" role="navigation" aria-label="Navegaci√≥ principal">
      <div class="brand" aria-label="Identitat del lloc">
        <div class="logo" aria-hidden="true" title="Focus Academy">Q</div>
        <h1 style="white-space:nowrap">Focus Academy ¬∑ Matem√†tiques</h1>
      </div>

      <nav class="right" aria-label="Vistes">
        <button class="pill" onclick="showView('home')" aria-label="Anar a Inici">Inici</button>
        <button class="pill" onclick="showView('results')" aria-label="Anar a Resultats">Resultats</button>
        <button class="pill" onclick="showView('about')" aria-label="Anar a Sobre">Sobre</button>
        <button class="pill" onclick="window.location.href='teoria.html'" aria-label="Obrir Teoria">Teoria</button>
        <input id="studentName" class="input" placeholder="Nom de l'alumne/a" aria-label="Nom de l'alumne o alumna" />
      </nav>
    </div>
  </header>

  <main class="wrap">
    <!-- HOME -->
    <section id="view-home" class="hero" aria-labelledby="home-title">
      <div class="panel card fade-in">
        <h2 class="title" id="home-title">Benvingut/da! üëã</h2>
        <p class="subtitle">Tria un m√≤dul per configurar-lo i comen√ßar. Tot queda guardat en aquest dispositiu (sense comptes).</p>

        <div class="section-title">M√≤duls de matem√†tiques</div>
        <div class="grid" id="moduleGrid" aria-live="polite"></div>
      </div>
    </section>

    <!-- CONFIG -->
    <section id="view-config" class="hidden" aria-labelledby="cfg-title">
      <div class="panel card fade-in">
        <div class="row" style="align-items:center">
          <div>
            <h2 class="title" id="cfg-title" style="margin:0">Configura el m√≤dul</h2>
            <p class="subtitle" id="cfg-desc"></p>
          </div>
          <div class="controls" role="group" aria-label="Accions de configuraci√≥">
            <button class="btn-secondary" onclick="showView('home')" aria-label="Tornar a Inici">‚Üê Torna</button>
            <button onclick="startFromConfig()" aria-label="Comen√ßar el q√ºestionari">Comen√ßa</button>
          </div>
        </div>

        <div class="section-title">Opcions comunes</div>
        <div class="controls">
          <label class="field chip" for="cfg-count">Preguntes
            <select id="cfg-count" aria-label="Nombre de preguntes">
              <option>10</option><option>20</option><option>30</option><option>50</option>
            </select>
          </label>
          <label class="field chip" for="cfg-time">Temps (min)
            <select id="cfg-time" aria-label="L√≠mit de temps en minuts">
              <option value="0">Sense l√≠mit</option><option>5</option><option>10</option><option>15</option><option>20</option>
            </select>
          </label>
          <label class="field chip" for="cfg-level">Nivell (1‚Äì20)
            <select id="cfg-level" aria-label="Nivell de dificultat"></select>
          </label>
        </div>

        <div id="cfg-specific" aria-live="polite"></div>
      </div>
    </section>

    <!-- QUIZ -->
    <section id="view-quiz" class="hidden" aria-labelledby="quiz-title">
      <div class="quiz">
        <!-- Columna pregunta -->
        <div class="panel card fade-in">
          <div class="q-header">
            <div style="display:flex; align-items:center; gap:10px">
              <span id="qModule" class="badge" aria-live="polite">M√≤dul</span>
              <span id="qLevel" class="chip">Nivell 1</span>
              <span id="timer" class="chip timer" aria-live="polite">--:--</span>
            </div>
            <div class="progress" style="flex:1" data-anim="true" aria-label="Progr√©s"><i id="bar"></i></div>
          </div>

          <div class="q">
            <div class="meta" id="qMeta" aria-live="polite">Pregunta 1 de 10</div>
            <h2 id="qText" style="margin-top:2px">‚Äî</h2>
            <div id="qMedia" style="margin:4px 0 2px"></div>

            <div class="answer-row">
              <input id="answer" class="input answer" placeholder="Resposta" inputmode="decimal" aria-label="Resposta" />
              <button id="btnCheck" title="Comprova (Enter)">Comprova (‚Üµ)</button>
              <button class="btn-secondary" id="btnSkip" title="Omet (Fletxa dreta)">Omet (‚Üí)</button>
            </div>

            <div id="feedback" class="feedback" aria-live="polite" style="display:none"></div>
          </div>
        </div>

        <!-- Columna teclat -->
        <div class="panel card fade-in">
          <h3 class="title" id="quiz-title" style="margin-top:0">Teclat</h3>
          <div class="board" role="group" aria-label="Tecles" id="keyboard">
            <button onclick="typeKey('7')" aria-label="7">7</button>
            <button onclick="typeKey('8')" aria-label="8">8</button>
            <button onclick="typeKey('9')" aria-label="9">9</button>

            <button onclick="typeKey('4')" aria-label="4">4</button>
            <button onclick="typeKey('5')" aria-label="5">5</button>
            <button onclick="typeKey('6')" aria-label="6">6</button>

            <button onclick="typeKey('1')" aria-label="1">1</button>
            <button onclick="typeKey('2')" aria-label="2">2</button>
            <button onclick="typeKey('3')" aria-label="3">3</button>

            <button onclick="typeKey('0')" aria-label="0">0</button>
            <button onclick="typeKey('-')" aria-label="Canvia signe">¬±</button>
            <button onclick="typeKey('del')" aria-label="Esborrar">‚å´</button>
            
            <!-- Bot√≥ d'infinit (nom√©s visible per al m√≤dul de funcions) -->
            <button id="infinityBtn" onclick="typeKey('‚àû')" aria-label="Infinit" style="display:none">‚àû</button>
          </div>
          <div style="margin-top:10px; display:flex; gap:10px; align-items:center">
            <span class="kbd" aria-hidden="true">‚Üµ</span> <span class="subtitle">comprova</span>
            <span class="kbd" aria-hidden="true">‚Üí</span> <span class="subtitle">omet</span>
          </div>
        </div>
      </div>
    </section>

    <!-- RESULTS -->
    <section id="view-results" class="hidden" aria-labelledby="results-title">
      <div class="panel card fade-in">
        <div class="row">
          <h3 class="title" id="results-title" style="margin:0">Resultats guardats</h3>
          <div class="tbl-actions" role="group" aria-label="Accions de resultats">
            <button class="btn-secondary" onclick="exportCSV()">Exporta CSV</button>
            <button class="btn-ghost" onclick="clearResults()">Neteja</button>
          </div>
        </div>

        <div style="display:flex; gap:10px; flex-wrap:wrap; margin-bottom:10px">
          <label class="chip" for="filter-module">Filtra m√≤dul:
            <select id="filter-module" aria-label="Filtra per m√≤dul"></select>
          </label>
          <label class="chip" for="filter-student">Alumne/a:
            <input id="filter-student" class="input" placeholder="Tots" style="width:160px" aria-label="Filtra per alumne/a">
          </label>
        </div>

        <div id="resultsTable" aria-live="polite">No hi ha dades encara.</div>
      </div>
    </section>

    <!-- ABOUT -->
    <section id="view-about" class="hidden" aria-labelledby="about-title">
      <div class="panel card fade-in">
        <h3 class="title" id="about-title" style="margin-top:0">Sobre aquesta eina</h3>
        <p class="subtitle">Web single-file creada per Focus Academy. Inspirada en ThatQuiz, sense comptes ni depend√®ncies. Dades locals al navegador.</p>
        <ul>
          <li>Generador de preguntes per: Aritm√®tica, Fraccions, Percentatges, Equacions lineals, Geometria (√†rees/per√≠metres), Estad√≠stica, Unitats i Funcions.</li>
          <li>Temps opcional, nivell 1‚Äì20, i rep√†s de nom√©s les preguntes err√≤nies.</li>
          <li>Historial exportable a CSV i mode offline (funciona sense internet).</li>
        </ul>
      </div>
    </section>

    <footer class="wrap" style="display:flex; align-items:center; justify-content:space-between; gap:16px">
      <div>Fet amb ‚ù§Ô∏è per Focus Academy ¬∑ ¬© <span id="year"></span></div>
      <img src="https://static.wixstatic.com/media/543803_e8b22e64a34945f9ba54d4ca39fa3645~mv2.png/v1/crop/x_836,y_591,w_1877,h_1328/fill/w_642,h_454,al_c,q_85,usm_0.66_1.00_0.01,enc_avif,quality_auto/543803_e8b22e64a34945f9ba54d4ca39fa3645~mv2.png"
           alt="Logo Focus Academy" style="height:40px; width:auto; object-fit:contain"
           referrerpolicy="no-referrer" />
    </footer>
  </main>

  <script src="main.js" defer></script>
  <script>
    // Millores petites sense interferir amb el teu JS:
    // 1) Any al footer
    (function(){ const y = document.getElementById('year'); if (y) y.textContent = new Date().getFullYear(); })();

    // 2) Accessibilitat: mostra visualment el contenidor de feedback quan hi ha text
    (function(){
      const fb = document.getElementById('feedback');
      if (!fb) return;
      const mo = new MutationObserver(() => {
        if (fb.textContent && fb.textContent.trim().length) {
          fb.style.display = '';
        }
      });
      mo.observe(fb, { childList: true, subtree: true, characterData: true });
    })();
    
    // 3) Mostra/amaga el bot√≥ d'infinit segons el m√≤dul
    (function(){
      // Observa els canvis en la vista del q√ºestionari
      const quizView = document.getElementById('view-quiz');
      if (!quizView) return;
      
      const observer = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
          if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
            const isQuizVisible = !quizView.classList.contains('hidden');
            if (isQuizVisible) {
              // Comprova si estem al m√≤dul de funcions
              const moduleName = document.getElementById('qModule').textContent;
              const infinityBtn = document.getElementById('infinityBtn');
              if (infinityBtn) {
                infinityBtn.style.display = moduleName.includes('Funcions') ? 'block' : 'none';
              }
            }
          }
        });
      });
      
      observer.observe(quizView, { attributes: true });
    })();
  </script>
</body>
</html>
