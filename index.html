<!DOCTYPE html>
<html lang="ca">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Focus Academy Quiz ‚Äî Assignatura ¬∑ Temes ¬∑ Nivell</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0b1020; --panel:#121834; --card:#0f1536; --ink:#eef2ff; --muted:#a7b0d8;
      --accent:#7dd3fc; --accent2:#a5b4fc; --ok:#86efac; --err:#fca5a5;
      --radius:22px; --shadow:0 18px 40px rgba(0,0,0,.35), 0 6px 16px rgba(0,0,0,.25);
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      color:var(--ink);
      background:
        radial-gradient(1200px 800px at 10% -10%, #1a234b, transparent 60%),
        radial-gradient(900px 600px at 110% 10%, #2a2450, transparent 60%),
        radial-gradient(1200px 900px at 50% 120%, #1d163f, #0b1020 60%);
    }
    a{color:inherit}
    header{
      position:sticky; top:0; z-index:50;
      backdrop-filter:saturate(140%) blur(10px); background:#0b1020cc; border-bottom:1px solid #ffffff22;
    }
    .container{max-width:1100px;margin:0 auto;padding:22px}
    .topbar{display:flex;justify-content:space-between;align-items:center}
    .brand{display:flex;align-items:center;gap:12px;font-weight:800}
    .logo{width:42px;height:42px;border-radius:14px;display:grid;place-items:center;background:linear-gradient(135deg,var(--accent),var(--accent2));box-shadow:var(--shadow);font-size:22px}
    .pill{padding:10px 16px;border:1px solid #ffffff1a;border-radius:999px}
    .btn{border:none;border-radius:14px;padding:12px 18px;font-weight:800;cursor:pointer;transition:.15s;color:#0b1020}
    .btn:hover{filter:brightness(1.06); transform:translateY(-1px)}
    .btn-primary{background:linear-gradient(135deg,var(--accent),var(--accent2))}
    .btn-ghost{background:#ffffff14;color:var(--ink)}
    .grid{display:grid;gap:18px}
    .two{grid-template-columns:1.2fr .8fr}
    .card{background:linear-gradient(180deg,#121834cc,#0e1432cc);border:1px solid #ffffff1a;border-radius:var(--radius);box-shadow:var(--shadow)}
    .card-inner{padding:22px}
    label{font-size:13px;color:var(--muted);display:block;margin-bottom:6px}
    input,select{width:100%;padding:12px 14px;border-radius:14px;border:1px solid #ffffff22;background:#0f1536;color:var(--ink)}
    .chips{display:flex;gap:10px;flex-wrap:wrap}
    .chip{padding:10px 12px;border-radius:999px;border:1px solid #ffffff22;background:#0f1536;cursor:pointer;user-select:none}
    .chip.active{outline:3px solid #7dd3fc55}
    h1{font-size:clamp(30px,4vw,48px);margin:8px 0 6px}
    h2{font-size:clamp(22px,3vw,28px);margin:0 0 10px}
    .question{font-size:26px;font-weight:800;margin:12px 0}
    .answers{display:flex;flex-direction:column;gap:10px;margin-top:12px}
    .ans{display:flex;align-items:center;gap:10px;padding:12px 14px;border:1px solid #ffffff22;border-radius:14px;background:#0f1536}
    .hint{color:var(--muted)}
    .progress-wrap{height:10px;background:#ffffff22;border-radius:999px;overflow:hidden}
    .progress{height:100%;width:0;background:linear-gradient(90deg,var(--accent),var(--accent2)); transition:width .25s}
    table{width:100%;border-collapse:collapse}
    th,td{border-bottom:1px solid #ffffff22;padding:10px;text-align:left}
    .ok{color:var(--ok);font-weight:800}
    .bad{color:var(--err);font-weight:800}
    .footer{opacity:.7;border-top:1px solid #ffffff22;padding:18px 0;margin-top:24px}
    @media (max-width:900px){.two{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <header>
    <div class="container topbar">
      <div class="brand"><div class="logo">üéì</div><div>Focus Academy Quiz</div></div>
      <nav class="chips">
        <a class="pill" href="#" id="goSetup">Configuraci√≥</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <!-- SETUP -->
    <section id="viewSetup" class="grid two">
      <div class="card">
        <div class="card-inner">
          <h1>Tria assignatura i tema</h1>
          <p class="hint">1) Assignatura ‚Üí 2) Tema(s) ‚Üí 3) Nivell ‚Üí 4) N¬∫ de preguntes</p>

          <div class="grid" style="grid-template-columns:1fr 1fr;gap:14px;margin-top:8px">
            <div>
              <label>Assignatura</label>
              <select id="subject">
                <option value="arith" selected>Aritm√®tica</option>
                <option value="percent">Percentatges</option>
                <!-- En el futur: fraccions, √†lgebra, comparacions, etc. -->
              </select>
            </div>
            <div>
              <label>Nivell</label>
              <select id="level">
                <option value="easy">F√†cil</option>
                <option value="med" selected>Normal</option>
                <option value="hard">Dif√≠cil</option>
              </select>
            </div>
            <div>
              <label>Nombre de preguntes</label>
              <input id="numQ" type="number" min="5" max="50" value="10">
            </div>
            <div>
              <label>Feedback immediat</label>
              <select id="instant">
                <option value="on" selected>Activat</option>
                <option value="off">Desactivat</option>
              </select>
            </div>
          </div>

          <div style="margin-top:14px">
            <label>Temes</label>
            <!-- Din√†mic segons assignatura -->
            <div id="topics" class="chips"></div>
            <div class="hint" id="topicsHint" style="margin-top:6px">Selecciona 1 o m√©s temes.</div>
          </div>

          <div style="margin-top:16px">
            <button class="btn btn-primary" id="startBtn">Comen√ßar</button>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-inner">
          <h2>Indicadors</h2>
          <div class="grid" style="grid-template-columns:repeat(3,1fr)">
            <div><div class="hint">Data</div><div style="font-weight:800" id="today"></div></div>
            <div><div class="hint">Mode</div><div style="font-weight:800" id="modeTag">Alumne</div></div>
            <div><div class="hint">Versi√≥</div><div style="font-weight:800">MVP</div></div>
          </div>
          <p class="hint" style="margin-top:10px">Aquest MVP genera preguntes al moment i, en acabar, et proposa un examen amb nom√©s les err√≤nies.</p>
        </div>
      </div>
    </section>

    <!-- QUIZ -->
    <section id="viewQuiz" class="card" hidden>
      <div class="card-inner">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <h2 id="quizTitle">Q√ºestionari</h2>
          <div class="hint" id="progressText">Pregunta 1/10</div>
        </div>
        <div class="progress-wrap" style="margin:8px 0 12px"><div id="progressBar" class="progress"></div></div>

        <div id="qText" class="question">‚Äî</div>
        <div id="answerArea"></div>

        <div class="chips" style="margin-top:14px">
          <button class="btn btn-ghost" id="prevBtn">‚Üê Anterior</button>
          <button class="btn btn-primary" id="nextBtn">Seg√ºent ‚Üí</button>
          <button class="btn btn-ghost" id="finishBtn">Finalitzar</button>
        </div>
        <div id="instantBox" class="hint" style="margin-top:10px"></div>
      </div>
    </section>

    <!-- REPORT -->
    <section id="viewReport" class="card" hidden>
      <div class="card-inner">
        <h2>Correcci√≥ i resultats</h2>
        <div class="chips" style="margin-bottom:10px">
          <div><span class="hint">Encerts</span> <strong id="repCorrect">0</strong></div>
          <div><span class="hint">Percentatge</span> <strong id="repPct">0%</strong></div>
          <div><span class="hint">Temps total</span> <strong id="repTime">‚Äî</strong></div>
        </div>
        <div style="overflow:auto">
          <table id="repTable">
            <thead><tr><th>#</th><th>Pregunta</th><th>Resposta</th><th>Correcta</th><th>Temps (s)</th><th>Resultat</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
        <div class="chips" style="margin-top:14px">
          <button class="btn btn-primary" id="retryWrong">Practicar nom√©s err√≤nies</button>
          <button class="btn btn-ghost" id="restart">Tornar a la configuraci√≥</button>
        </div>
      </div>
    </section>

    <footer class="footer">¬© <span id="year"></span> Focus Academy</footer>
  </main>

<script>
/* ====== Utils ====== */
const $ = s => document.querySelector(s);
const $$ = s => Array.from(document.querySelectorAll(s));
const today = new Date();
$('#today').textContent = today.toLocaleDateString('ca-ES');
$('#year').textContent = today.getFullYear();
function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]] } return a }
function fmtTime(s){ const m=Math.floor(s/60), r=s%60; return `${m}:${String(r).padStart(2,'0')}` }

/* ====== Estat global ====== */
let state = {
  subject: 'arith',
  topics: new Set(),        // conjunt de temes seleccionats
  level: 'med',
  n: 10,
  instant: true,
  questions: [],
  current: 0,
  answers: [],
  times: [],
  startTime: null,
  perQStart: null,
  lastResultRows: []        // per reconstruir nom√©s err√≤nies
};

/* ====== Temes per assignatura ====== */
const SUBJECTS = {
  arith: {
    label: 'Aritm√®tica',
    topics: [
      {id:'sum', label:'Sumes (+)'},
      {id:'sub', label:'Restes (‚àí)'},
      {id:'mul', label:'Multiplicacions (√ó)'},
      {id:'div', label:'Divisions (√∑)'},
      {id:'mix', label:'Barrejat'}
    ]
  },
  percent: {
    label: 'Percentatges',
    topics: [
      {id:'basic', label:'% d‚Äôun nombre'},
      {id:'inc', label:'Augment (%)'},
      {id:'dec', label:'Descompte (%)'},
      {id:'mix', label:'Barrejat'}
    ]
  }
};

/* ====== UI de temes din√†mica ====== */
function renderTopics(){
  const sub = $('#subject').value;
  const box = $('#topics'); box.innerHTML = '';
  const def = SUBJECTS[sub];
  def.topics.forEach(t=>{
    const chip = document.createElement('button');
    chip.type='button';
    chip.className='chip';
    chip.textContent = t.label;
    chip.dataset.id = t.id;
    chip.addEventListener('click', ()=>{
      if(state.topics.has(t.id)) state.topics.delete(t.id); else state.topics.add(t.id);
      chip.classList.toggle('active', state.topics.has(t.id));
    });
    box.appendChild(chip);
  });
  // selecci√≥ per defecte: mix
  state.topics = new Set(['mix']);
  $$('#topics .chip').forEach(c=> c.classList.toggle('active', c.dataset.id==='mix'));
}
$('#subject').addEventListener('change', renderTopics);
renderTopics();

/* ====== Generadors de preguntes ====== */
function randInt(min, max){ return Math.floor(Math.random()*(max-min+1))+min }

function genArithmeticOne(level, topic){
  const ranges={easy:[0,20],med:[-20,50],hard:[-100,100]};
  const [min,max]=ranges[level]||ranges.med;
  let opList = [];
  if(topic==='mix'){ opList=['+','-','√ó','√∑']; }
  else if(topic==='sum') opList=['+'];
  else if(topic==='sub') opList=['-'];
  else if(topic==='mul') opList=['√ó'];
  else if(topic==='div') opList=['√∑'];
  const op = opList[Math.floor(Math.random()*opList.length)];
  let a = randInt(min,max);
  let b = randInt(min,max);
  if(op==='√∑'){
    b = randInt(2,20);
    a = b * randInt(0,10); // assegura divisi√≥ exacta
  }
  const text = `${a} ${op} ${b}`;
  const correct = op==='+'? a+b : op==='-'? a-b : op==='√ó'? a*b : a/b;
  const type = Math.random()<0.5? 'numeric':'mc';
  let options;
  if(type==='mc'){
    const noise = [correct+1, correct-1, correct + (Math.sign(correct)||1)*2, correct===0? 3 : Number((correct*1.1).toFixed(2))];
    options = shuffle([correct, ...noise]).slice(0,4);
  }
  return {subject:'arith', topic, text, type, correct, options};
}

function genPercentOne(level, topic){
  const base = level==='hard'? randInt(100,1000) : randInt(10,100);
  let p;
  if(topic==='mix') p = [5,10,12.5,20,25,30,40,50,60,75][randInt(0,9)];
  else if(topic==='basic') p = [5,10,20,25,50][randInt(0,4)];
  else if(topic==='inc') p = [5,10,15,20,25][randInt(0,4)];
  else if(topic==='dec') p = [5,10,15,20,25][randInt(0,4)];
  let text, correct;
  if(topic==='basic' || topic==='mix'){
    text = `Quant √©s ${p}% de ${base}?`;
    correct = Number(((p/100)*base).toFixed(2));
  } else if(topic==='inc'){
    text = `Aplica un augment del ${p}% a ${base}`;
    correct = Number((base*(1+p/100)).toFixed(2));
  } else { // dec
    text = `Aplica un descompte del ${p}% a ${base}`;
    correct = Number((base*(1-p/100)).toFixed(2));
  }
  const type = Math.random()<0.5? 'numeric':'mc';
  let options;
  if(type==='mc'){
    options = shuffle([
      correct,
      Number((correct*0.9).toFixed(2)),
      Number((correct*1.1).toFixed(2)),
      Number(((p/100)*(base+10)).toFixed(2))
    ]);
  }
  return {subject:'percent', topic, text, type, correct, options};
}

function generateSet(subject, topicsChosen, level, n){
  const topicsArr = topicsChosen.size? [...topicsChosen] : ['mix'];
  const out = [];
  for(let i=0;i<n;i++){
    const t = topicsArr[i % topicsArr.length];
    if(subject==='arith') out.push(genArithmeticOne(level, t));
    else if(subject==='percent') out.push(genPercentOne(level, t));
  }
  return shuffle(out);
}

/* ====== Flux del quiz ====== */
function show(sel){
  ['#viewSetup','#viewQuiz','#viewReport'].forEach(s => $(s).hidden = true);
  $(sel).hidden = false;
}

function renderCurrent(){
  const q = state.questions[state.current];
  if(!q) return;
  $('#quizTitle').textContent = `${(SUBJECTS[state.subject].label)} ¬∑ ${topicLabel(state.subject, q.topic)} ¬∑ ${levelLabel(state.level)}`;
  $('#qText').textContent = q.text;
  $('#progressText').textContent = `Pregunta ${state.current+1}/${state.questions.length}`;
  $('#progressBar').style.width = `${Math.round(100*state.current/Math.max(1,state.questions.length-1))}%`;
  const area = $('#answerArea'); area.innerHTML='';
  if(q.type==='mc'){
    const wrap = document.createElement('div'); wrap.className='answers';
    q.options.forEach(opt=>{
      const row=document.createElement('label'); row.className='ans';
      row.innerHTML=`<input type="radio" name="ans" value="${opt}"> <span>${opt}</span>`;
      wrap.appendChild(row);
    });
    area.appendChild(wrap);
    const saved = state.answers[state.current];
    if(saved!=null){ $$('input[name="ans"]').forEach(el=>{ if(String(el.value)===String(saved)) el.checked=true; }); }
  } else {
    const input=document.createElement('input'); input.placeholder='Escriu la resposta‚Ä¶';
    input.value = state.answers[state.current] ?? '';
    area.appendChild(input);
  }
}

function readAnswer(){
  const q = state.questions[state.current];
  if(q.type==='mc'){ const sel = $$('input[name="ans"]').find(x=>x.checked); return sel? sel.value : ''; }
  return ($('#answerArea input')?.value || '').trim();
}

function checkAnswer(q, ans){
  if(ans==='' || ans==null) return false;
  if(q.type==='mc') return String(ans)===String(q.correct);
  if(q.type==='numeric') return Number(ans)===Number(q.correct);
  return false;
}

function saveTime(){ const now=Date.now(); state.times[state.current]+= Math.round((now-(state.perQStart||now))/1000); state.perQStart=now; }

function startQuiz(){
  state.subject = $('#subject').value;
  state.level = $('#level').value;
  state.n = Math.min(50, Math.max(5, Number($('#numQ').value||10)));
  state.instant = $('#instant').value==='on';
  const chosen = state.topics.size ? new Set(state.topics) : new Set(['mix']);
  state.questions = generateSet(state.subject, chosen, state.level, state.n);
  state.current = 0;
  state.answers = Array(state.n).fill('');
  state.times = Array(state.n).fill(0);
  state.startTime = Date.now();
  state.perQStart = Date.now();
  $('#modeTag').textContent = 'Alumne';
  $('#instantBox').textContent = '';
  show('#viewQuiz'); renderCurrent();
}

function nextQ(){
  saveTime();
  const ans = readAnswer();
  state.answers[state.current] = ans;
  if(state.instant){
    const ok = checkAnswer(state.questions[state.current], ans);
    $('#instantBox').textContent = ans===''? '' : (ok? '‚úî Correcte' : `‚úò Incorrecte. Resposta: ${state.questions[state.current].correct}`);
    $('#instantBox').style.color = ok? 'var(--ok)' : 'var(--err)';
  }
  if(state.current < state.questions.length-1){
    state.current++; state.perQStart=Date.now(); renderCurrent();
  }
}
function prevQ(){
  saveTime();
  const ans = readAnswer();
  state.answers[state.current] = ans;
  if(state.current>0){ state.current--; state.perQStart=Date.now(); renderCurrent(); }
}

function finishQuiz(){
  saveTime();
  const rows=[]; let correct=0;
  for(let i=0;i<state.questions.length;i++){
    const q=state.questions[i]; const ans=state.answers[i]; const ok=checkAnswer(q, ans); if(ok) correct++;
    rows.push([i+1, q.text, ans||'‚Äî', q.correct, state.times[i], ok? '‚úî':'‚úò', {q, ans, ok}]);
  }
  state.lastResultRows = rows; // guarda detall per ‚ÄúPracticar err√≤nies‚Äù
  const pct = Math.round(100*correct/state.questions.length);
  $('#repCorrect').textContent = `${correct}/${state.questions.length}`;
  $('#repPct').textContent = `${pct}%`;
  $('#repTime').textContent = fmtTime(Math.round((Date.now()-state.startTime)/1000));
  const tb = $('#repTable tbody'); tb.innerHTML='';
  rows.forEach(r=>{
    const tr=document.createElement('tr');
    tr.innerHTML = `<td>${r[0]}</td><td>${r[1]}</td><td>${r[2]}</td><td>${r[3]}</td><td>${r[4]}</td><td class="${r[5]==='‚úî'?'ok':'bad'}">${r[5]}</td>`;
    tb.appendChild(tr);
  });
  show('#viewReport');
}

/* ====== Practicar nom√©s err√≤nies ====== */
function retryWrongOnly(){
  const wrong = state.lastResultRows.filter(r=> r[5]==='‚úò').map(r=> r[6].q);
  if(wrong.length===0){ alert('Genial! No hi ha err√≤nies per repetir.'); return; }
  // Reutilitza exactament les mateixes preguntes err√≤nies (mateix enunciat i soluci√≥)
  state.questions = wrong.map(q => ({...q})); // clonar
  state.current = 0;
  state.answers = Array(wrong.length).fill('');
  state.times = Array(wrong.length).fill(0);
  state.startTime = Date.now();
  state.perQStart = Date.now();
  $('#instantBox').textContent = '';
  show('#viewQuiz'); renderCurrent();
}

/* ====== Helpers ====== */
function topicLabel(sub, t){
  const def = SUBJECTS[sub]; const hit = def.topics.find(x=>x.id===t);
  return hit? hit.label : 'Tema';
}
function levelLabel(l){ return ({easy:'F√†cil', med:'Normal', hard:'Dif√≠cil'})[l] || l }

/* ====== Events ====== */
$('#startBtn').addEventListener('click', startQuiz);
$('#nextBtn').addEventListener('click', nextQ);
$('#prevBtn').addEventListener('click', prevQ);
$('#finishBtn').addEventListener('click', finishQuiz);
$('#retryWrong').addEventListener('click', retryWrongOnly);
$('#restart').addEventListener('click', ()=> show('#viewSetup'));
$('#goSetup').addEventListener('click', (e)=>{ e.preventDefault(); show('#viewSetup') });

/* inici */
show('#viewSetup');
</script>
</body>
</html>
