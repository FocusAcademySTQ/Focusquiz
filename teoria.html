<!doctype html>
<html lang="ca" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Biblioteca de Teoria · Matemàtiques</title>
  <meta name="description" content="Repositori de teoria de Matemàtiques: aritmètica, fraccions, percentatges, geometria, estadística, unitats, equacions, potències, proporcions i funcions lineals." />
  <style>
    /* ========= Design tokens ========= */
    :root{
      --bg: #f5f7fb;
      --surface: #ffffff;
      --surface-soft: #f0f4ff;
      --text: #0f172a;
      --muted: #55607a;
      --hair: #e5e7eb;

      --brand-1: #7aa2ff;
      --brand-2: #a78bfa;
      --brand-3: #34d399;
      --accent: #6366f1;
      --ring: rgba(122,162,255,.32);

      --radius-lg: 16px;
      --radius-md: 12px;
      --shadow-1: 0 10px 30px rgba(16,24,40,.08);
      --shadow-2: 0 6px 18px rgba(16,24,40,.08);
      --glass: linear-gradient(180deg, rgba(255,255,255,.75), rgba(255,255,255,.55));
      --brand-grad: linear-gradient(90deg, var(--brand-1), var(--brand-2), var(--brand-3));

      --chip-grad: linear-gradient(135deg,#fde68a,#a7f3d0);
      --hl: #fde68a;
    }
    [data-theme="dark"]{
      --bg: #0b1220;
      --surface: #0f172a;
      --surface-soft: #111b2e;
      --text: #e5e7eb;
      --muted: #94a3b8;
      --hair: #213045;

      --shadow-1: 0 10px 30px rgba(2,6,23,.55);
      --shadow-2: 0 6px 18px rgba(2,6,23,.45);
      --glass: linear-gradient(180deg, rgba(15,23,42,.75), rgba(15,23,42,.5));
      --ring: rgba(99,102,241,.35);
    }

    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      color:var(--text);
      background:
        radial-gradient(1200px 600px at 12% -6%, rgba(122,162,255,.18), transparent 60%),
        radial-gradient(1000px 560px at 88% -10%, rgba(167,139,250,.15), transparent 60%),
        var(--bg);
    }
    a{ color:var(--accent); text-decoration:none } a:hover{text-decoration:underline}

    /* ========= New top bar (glassy) ========= */
    .topbar{
      position:sticky; top:0; z-index:50;
      backdrop-filter: blur(10px) saturate(1.15);
      background: var(--glass);
      border-bottom:1px solid var(--hair);
    }
    .topbar .wrap{
      max-width:1200px; margin:0 auto; padding:12px 16px;
      display:flex; align-items:center; gap:14px;
    }
    .logo{
      width:40px; height:40px; border-radius:12px;
      background: var(--brand-grad);
      box-shadow: var(--shadow-2);
    }
    .brand h1{ margin:0; font-size:1.12rem; font-weight:900; letter-spacing:.2px }
    .brand p{ margin:0; color:var(--muted); font-size:.92rem }
    .top-actions{
      margin-left:auto; display:flex; align-items:center; gap:10px; flex-wrap:wrap;
    }

    .searchbar{
      display:flex; align-items:center; gap:8px;
      background: var(--surface-soft);
      border:1px solid var(--hair);
      padding:8px 10px; border-radius:12px; min-width:260px;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.35);
    }
    .searchbar input{
      background:transparent; border:0; outline:none; color:var(--text); flex:1; font-size:.95rem;
    }
    .btn{
      border:1px solid var(--hair); background: var(--surface);
      color:var(--text); padding:8px 12px; border-radius:12px; cursor:pointer; font-weight:700; font-size:.92rem;
      transition:.18s; box-shadow: var(--shadow-2);
    }
    .btn:hover{ transform: translateY(-1px); box-shadow: 0 10px 24px rgba(15,23,42,.14) }
    .btn-ghost{ background:transparent; border-style:dashed; color:var(--muted); box-shadow:none }

    /* ========= New layout with unified sidebar look ========= */
    .app{
      display:grid; grid-template-columns: 300px 1fr; min-height: calc(100vh - 64px);
      max-width:1200px; margin:12px auto 0; padding:0 16px 60px;
      gap:16px;
    }
    @media (max-width:1100px){ .app{ grid-template-columns: 1fr } }

    aside{
      position:sticky; top:84px; align-self:start;
      background: var(--glass);
      border:1px solid var(--hair); border-radius: var(--radius-lg);
      box-shadow: var(--shadow-1);
      padding:14px;
    }
    .side-head{
      display:flex; align-items:center; gap:10px; margin-bottom:8px;
    }
    .side-head .dot{
      width:10px; height:10px; border-radius:999px; background: var(--brand-1);
      box-shadow: 0 0 0 4px rgba(122,162,255,.18), 0 0 0 8px rgba(122,162,255,.08);
    }
    .side-search{
      display:flex; align-items:center; gap:8px;
      background: var(--surface); border:1px solid var(--hair);
      padding:8px 10px; border-radius:12px; margin:8px 0 10px;
    }
    .side-search input{ background:transparent; border:0; outline:none; color:var(--text); flex:1 }

    .side-actions{ display:flex; gap:8px; margin:8px 0 12px; flex-wrap:wrap }
    .toggle{ margin-left:auto; display:flex; align-items:center; gap:8px; font-size:.9rem; color:var(--muted) }

    nav ul{ list-style:none; padding:0; margin:8px 0 0 }
    nav li+li{ margin-top:4px }
    nav a{
      display:flex; gap:10px; align-items:center; padding:8px 10px;
      border:1px solid transparent; border-radius:10px; color:var(--text);
      background: linear-gradient(180deg, rgba(255,255,255,.25), rgba(255,255,255,.08));
    }
    [data-theme="dark"] nav a{ background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02)); }
    nav a:hover{ border-color: var(--hair) }
    nav a.active{
      border-color: transparent;
      background: linear-gradient(90deg, rgba(122,162,255,.22), rgba(167,139,250,.22));
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.15);
    }
    .chip{ font-size:.78rem; color:#0f172a; background: var(--chip-grad); padding:.15rem .5rem; border-radius:999px }

    main{ }
    .container{ }
    section.topic{ scroll-margin-top:100px }
    .card{
      background: var(--surface);
      border:1px solid var(--hair);
      border-radius: var(--radius-lg);
      padding:18px;
      box-shadow: var(--shadow-1);
    }
    .topic{ margin:8px 0 20px }
    .topic h2{
      margin:0 0 8px; font-size:1.35rem; font-weight:900;
      background: var(--brand-grad); -webkit-background-clip:text; background-clip:text; color:transparent;
    }
    .topic .subtitle{ margin:0 0 12px; color:var(--muted) }

    .grid{ display:grid; grid-template-columns: repeat(12,1fr); gap:14px }
    .col-4{ grid-column: span 4 } .col-6{ grid-column: span 6 } .col-8{ grid-column: span 8 } .col-12{ grid-column: span 12 }
    @media (max-width:1100px){ .grid{ grid-template-columns: 1fr } .col-4,.col-6,.col-8,.col-12{ grid-column:1/-1 } }

    .callout{ border-left:3px solid var(--brand-1); background:rgba(122,162,255,.12); padding:10px 12px; border-radius:12px }
    [data-theme="dark"] .callout{ background:rgba(122,162,255,.1) }

    details{ border:1px dashed var(--hair); border-radius:12px; padding:10px 12px }
    details summary{ cursor:pointer; font-weight:700 }

    code.formula{
      background: var(--surface-soft);
      padding:.2rem .5rem; border-radius:10px; border:1px solid var(--hair);
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
    }
    .formula-wrap{ display:flex; align-items:center; gap:8px; margin:4px 0 8px }
    .copy{ border:1px solid var(--hair); background:var(--surface); color:var(--text); padding:6px 10px; border-radius:10px; cursor:pointer; font-size:.85rem; box-shadow: var(--shadow-2) }
    .copy:hover{ box-shadow: 0 10px 24px rgba(15,23,42,.14) }

    .tag{ display:inline-block; font-size:.72rem; color:#0f172a; background:#86efac; padding:.1rem .45rem; border-radius:6px; margin-right:6px }
    .ex{ background:rgba(20,184,166,.08); border:1px solid rgba(94,234,212,.25) }
    .hl{ background:var(--hl); color:#1f2937; padding:0 .2em; border-radius:.25em }
    .muted{ color:var(--muted) }

    .footer{ text-align:center; color:var(--muted); font-size:.9rem; padding:28px 0 40px }

    .top-btn{
      position:fixed; right:18px; bottom:18px; z-index:10; display:none; padding:10px 12px; border-radius:12px;
      background: var(--surface); color:var(--text); border:1px solid var(--hair); cursor:pointer; box-shadow: var(--shadow-2);
    }
    .top-btn.show{ display:inline-block }

    @media print{
      .topbar, aside, .top-btn { display:none !important }
      .app{ padding:0 }
      section.topic{ page-break-inside:avoid }
      .card{ box-shadow:none }
    }
  </style>
</head>
<body>
  <!-- NEW TOP BAR -->
  <div class="topbar" role="banner">
    <div class="wrap">
      <div class="logo" aria-hidden="true"></div>
      <div class="brand">
        <h1>Biblioteca de Teoria · Matemàtiques</h1>
        <p class="muted">Repositori per a alumnes — clar, visual i navegable</p>
      </div>

      <div class="top-actions">
        <div class="searchbar" role="search" aria-label="Cerca global">
          <svg aria-hidden="true" width="18" height="18" viewBox="0 0 24 24" fill="none">
            <path d="M21 21l-4.2-4.2M10.8 18.6a7.8 7.8 0 1 1 0-15.6 7.8 7.8 0 0 1 0 15.6z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
          <input id="q" placeholder="Cerca temes, fórmules… (tecla /)" />
        </div>
        <button class="btn" id="expand">Expandir tot</button>
        <button class="btn btn-ghost" id="collapse">Plegar</button>
        <label class="toggle">
          <input type="checkbox" id="theme" />
          Mode fosc
        </label>
      </div>
    </div>
  </div>

  <div class="app">
    <!-- NEW SIDEBAR -->
    <aside aria-label="Navegació de mòduls">
      <div class="side-head">
        <div class="dot"></div>
        <strong>Continguts</strong>
      </div>

      <div class="side-search" role="search" aria-label="Cerca al menú">
        <svg aria-hidden="true" width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M21 21l-4.2-4.2M10.8 18.6a7.8 7.8 0 1 1 0-15.6 7.8 7.8 0 0 1 0 15.6z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
        <input id="tocFilter" placeholder="Filtra seccions…" />
      </div>

      <div class="side-actions">
        <button class="btn" id="expandSide">Obrir seccions</button>
        <button class="btn btn-ghost" id="collapseSide">Tancar</button>
      </div>

      <nav>
        <ul id="toc">
          <li><a href="#aritmetica"><span class="chip">1</span>&nbsp;Aritmètica</a></li>
          <li><a href="#fraccions"><span class="chip">2</span>&nbsp;Fraccions</a></li>
          <li><a href="#percentatges"><span class="chip">3</span>&nbsp;Percentatges</a></li>
          <li><a href="#geometria"><span class="chip">4</span>&nbsp;Geometria</a></li>
          <li><a href="#estadistica"><span class="chip">5</span>&nbsp;Estadística bàsica</a></li>
          <li><a href="#unitats"><span class="chip">6</span>&nbsp;Unitats i conversions</a></li>
          <li><a href="#equacions"><span class="chip">7</span>&nbsp;Equacions</a></li>
          <li><a href="#potencies"><span class="chip">8</span>&nbsp;Potències i arrels</a></li>
          <li><a href="#proporcions"><span class="chip">9</span>&nbsp;Proporcions i raons</a></li>
          <li><a href="#funcions"><span class="chip">10</span>&nbsp;Funcions lineals</a></li>
        </ul>
      </nav>
    </aside>

    <main>
      <div class="container">
        <!-- ===== CONTINGUTS (id i seccions exactes tal com abans) ===== -->
        <!-- ARITMÈTICA -->
        <section class="topic" id="aritmetica">
          <div class="card">
            <h2>Aritmètica</h2>
            <p class="subtitle">Sumes, restes, multiplicacions i divisions. Propietats i ordre d’operacions.</p>
            <div class="grid">
              <div class="col-6">
                <div class="callout">
                  <b>Propietats bàsiques</b><br/>
                  <span class="tag">Commutativa</span> a + b = b + a, a·b = b·a<br/>
                  <span class="tag">Associativa</span> (a + b) + c = a + (b + c)<br/>
                  <span class="tag">Distributiva</span> a·(b + c) = a·b + a·c
                </div>
                <p><b>Jerarquia d’operacions</b>: <span class="hl">Parèntesis</span> → Exponents → Multiplicació/Divisió → Suma/Resta.</p>
                <div class="formula-wrap"><code class="formula" data-copy="(3+5)·2 - 4^2 = 16 - 16 = 0">(3+5)·2 − 4² = 16 − 16 = 0</code><button class="copy">Copiar</button></div>
              </div>
              <div class="col-6">
                <details open>
                  <summary>Exemple pas a pas</summary>
                  <div class="ex card" style="margin-top:10px">
                    <ol>
                      <li>Parèntesis: (7 − 3) = 4</li><li>Exponents: 4² = 16</li><li>Multiplica: 5·4 = 20</li><li>Resta: 20 − 16 = <b>4</b></li>
                    </ol>
                    <div class="formula-wrap"><code class="formula" data-copy="5·(7−3) − 4^2 = 4">5·(7−3) − 4² = 4</code><button class="copy">Copiar</button></div>
                  </div>
                </details>
              </div>
            </div>
          </div>
        </section>

        <!-- FRACCIONS -->
        <section class="topic" id="fraccions">
          <div class="card">
            <h2>Fraccions</h2>
            <p class="subtitle">Definició, simplificació, comparació i aritmètica amb fraccions.</p>
            <div class="grid">
              <div class="col-6">
                <p><span class="tag">Definició</span> <b>a/b</b> amb b≠0 representa <i>a</i> parts d’un total dividit en <i>b</i> parts iguals.</p>
                <p><span class="tag">Simplificar</span> divideix numerador i denominador pel <i>MCD</i>.</p>
                <div class="formula-wrap"><code class="formula" data-copy="12/18 = (12÷6)/(18÷6) = 2/3">12/18 = (12÷6)/(18÷6) = 2/3</code><button class="copy">Copiar</button></div>
                <p><span class="tag">Comparar</span> a/b ? c/d → creu: a·d ? c·b.</p>
              </div>
              <div class="col-6">
                <details open>
                  <summary>Aritmètica amb fraccions</summary>
                  <ul>
                    <li><b>Suma/resta</b>: a/b ± c/d = (ad ± bc)/bd</li>
                    <li><b>Multiplicació</b>: a/b · c/d = ac/bd</li>
                    <li><b>Divisió</b>: a/b ÷ c/d = a/b · d/c</li>
                  </ul>
                  <div class="formula-wrap"><code class="formula" data-copy="2/3 + 1/4 = (8+3)/12 = 11/12">2/3 + 1/4 = (8+3)/12 = 11/12</code><button class="copy">Copiar</button></div>
                </details>
                <details><summary>Mixt ↔ decimal</summary><p>2 1/5 = (2·5+1)/5 = 11/5; 11/5 = 2,2.</p></details>
              </div>
            </div>
          </div>
        </section>

        <!-- PERCENTATGES -->
        <section class="topic" id="percentatges">
          <div class="card">
            <h2>Percentatges</h2>
            <p class="subtitle">Percentatge d’un nombre, el nombre a partir d’un percentatge i descomptes/variacions.</p>
            <div class="grid">
              <div class="col-6">
                <p><span class="tag">Definició</span> p% = p/100.</p>
                <ul>
                  <li><b>p% de n</b> → n·(p/100)</li>
                  <li><b>part és p% de total</b> → total = part·100/p</li>
                  <li><b>Descompte p%</b> → preu·(1 − p/100)</li>
                </ul>
                <div class="formula-wrap"><code class="formula" data-copy="15% de 80 = 80·0,15 = 12">15% de 80 = 80·0,15 = 12</code><button class="copy">Copiar</button></div>
              </div>
              <div class="col-6">
                <details open>
                  <summary>Percentatge de canvi</summary>
                  <p>Canvi del valor <i>antic</i>→<i>nou</i>:</p>
                  <div class="formula-wrap"><code class="formula" data-copy="(nou − antic)/antic · 100%">(nou − antic)/antic · 100%</code><button class="copy">Copiar</button></div>
                  <p class="muted">Positiu: augment · Negatiu: disminució.</p>
                </details>
              </div>
            </div>
          </div>
        </section>

        <!-- GEOMETRIA -->
        <section class="topic" id="geometria">
          <div class="card">
            <h2>Geometria</h2>
            <p class="subtitle">Àrees i perímetres en 2D; volums en 3D. Recorda escriure la unitat correcta.</p>
            <div class="grid">
              <div class="col-4">
                <h3>Figures 2D</h3>
                <ul>
                  <li><b>Rectangle</b>: P = 2(b + h), A = b·h</li>
                  <li><b>Triangle</b>: A = (b·h)/2</li>
                  <li><b>Cercle</b>: P = π·d, A = π·r²</li>
                  <li><b>Polígon regular</b>: A = (P·apotema)/2</li>
                </ul>
                <div class="formula-wrap"><code class="formula" data-copy="A_rect = b·h;  A_tri = (b·h)/2;  A_cercle = π·r^2">A_rect = b·h;  A_tri = (b·h)/2;  A_cercle = π·r²</code><button class="copy">Copiar</button></div>
              </div>
              <div class="col-4">
                <h3>Cossos 3D</h3>
                <ul><li><b>Prisma rectangular</b>: V = a·b·c</li><li><b>Cilindre</b>: V = π·r²·h</li></ul>
                <div class="formula-wrap"><code class="formula" data-copy="V_prisma = a·b·c;  V_cilindre = π·r^2·h">V_prisma = a·b·c;  V_cilindre = π·r²·h</code><button class="copy">Copiar</button></div>
              </div>
              <div class="col-4">
                <div class="callout"><b>Unitats</b><br/>Perímetre: u · Àrea: u² · Volum: u³</div>
                <details><summary>Exemple ràpid</summary><p>Rectangle b=7 cm, h=4 cm → A = 28 cm², P = 22 cm.</p></details>
              </div>
            </div>
          </div>
        </section>

        <!-- ESTADÍSTICA -->
        <section class="topic" id="estadistica">
          <div class="card">
            <h2>Estadística bàsica</h2>
            <p class="subtitle">Tendència central, dispersió i lectura de gràfics.</p>
            <div class="grid">
              <div class="col-6">
                <h3>Tendència central</h3>
                <ul>
                  <li><b>Mitjana</b>: <code class="formula" data-copy="(Σx)/n">Σx / n</code></li>
                  <li><b>Mediana</b>: valor central</li>
                  <li><b>Moda</b>: valor més freqüent</li>
                </ul>
                <details><summary>Exemple</summary><p>Dades: 4, 5, 5, 7, 9 → Mitjana = 6, Mediana = 5, Moda = 5.</p></details>
              </div>
              <div class="col-6">
                <h3>Dispersió</h3>
                <ul>
                  <li><b>Rang</b>: max − min</li>
                  <li><b>Desviació mitjana</b>: <code class="formula" data-copy="(Σ|x−μ|)/n">(Σ|x−μ|)/n</code></li>
                </ul>
                <p class="muted">Interpreta barres/sectors identificant màxims i comparant categories.</p>
              </div>
            </div>
          </div>
        </section>

        <!-- UNITATS -->
        <section class="topic" id="unitats">
          <div class="card">
            <h2>Unitats i conversions</h2>
            <p class="subtitle">Factors de conversió i atenció a les potències de 10 (àrea/volum).</p>
            <div class="grid">
              <div class="col-6">
                <h3>Longitud, massa, volum</h3>
                <ul>
                  <li>1 km = 1000 m · 1 m = 100 cm · 1 cm = 10 mm</li>
                  <li>1 kg = 1000 g · 1 g = 1000 mg</li>
                  <li>1 L = 1000 mL</li>
                </ul>
                <div class="callout"><b>Àrea/Volum</b> · 1 m² = 10 000 cm² · 1 m³ = 1 000 000 cm³</div>
              </div>
              <div class="col-6">
                <details open>
                  <summary>Mètode del factor de conversió</summary>
                  <ol><li>Escriu el valor com a fracció.</li><li>Multiplica per factors “=1” que cancel·lin unitats.</li><li>Simplifica i calcula.</li></ol>
                  <div class="formula-wrap"><code class="formula" data-copy="2,5 km · (1000 m / 1 km) = 2500 m">2,5 km · (1000 m / 1 km) = 2500 m</code><button class="copy">Copiar</button></div>
                </details>
              </div>
            </div>
          </div>
        </section>

        <!-- EQUACIONS -->
        <section class="topic" id="equacions">
          <div class="card">
            <h2>Equacions</h2>
            <p class="subtitle">Subtemes amb dificultat progressiva.</p>

            <article class="card" style="margin-top:12px">
              <h3>1) Primer grau</h3>
              <p class="muted">Forma: <code class="formula" data-copy="ax + b = 0">ax + b = 0</code> · Aïlla <i>x</i>.</p>
              <ol><li>ax = −b</li><li>x = −b/a</li></ol>
              <details><summary>Exemple</summary><div class="formula-wrap"><code class="formula" data-copy="3x − 7 = 11 → 3x = 18 → x = 6">3x − 7 = 11 → 3x = 18 → x = 6</code><button class="copy">Copiar</button></div></details>
            </article>

            <article class="card" style="margin-top:12px">
              <h3>2) Segon grau</h3>
              <p><span class="tag">Completes</span> <code class="formula" data-copy="ax^2 + bx + c = 0">ax² + bx + c = 0</code> · <span class="tag">Incompletes</span> <code class="formula" data-copy="ax^2 + c = 0 / ax^2 + bx = 0">ax² + c = 0</code>, <code class="formula">ax² + bx = 0</code></p>
              <div class="callout"><b>Fórmula general</b><div class="formula-wrap" style="margin-top:6px"><code class="formula" data-copy="x = (-b ± √(b^2 - 4ac)) / (2a)">x = (−b ± √(b² − 4ac)) / (2a)</code><button class="copy">Copiar</button></div></div>
              <details><summary>Exemples</summary>
                <ul>
                  <li>Completa: x² − 5x + 6 = 0 → (x−2)(x−3)=0 → x=2,3</li>
                  <li>Sense terme x: 2x² + 18 = 0 → x² = −9 → (sense solució real)</li>
                  <li>Sense terme independent: 3x² − 12x = 0 → 3x(x − 4)=0 → x=0,4</li>
                </ul>
              </details>
            </article>

            <article class="card" style="margin-top:12px">
              <h3>3) Sistemes (2×2)</h3>
              <p class="muted">Mètodes: substitució, reducció/igualació. Tipus: única, cap, infinites.</p>
              <details open><summary>Substitució</summary>
                <ol><li>Aïlla una incògnita.</li><li>Substitueix i resol.</li><li>Troba l’altra.</li></ol>
                <div class="formula-wrap"><code class="formula" data-copy="{ x + y = 7; 2x − y = 1 } → y = 7 − x → 2x − (7 − x) = 1 → 3x = 8 → x=8/3, y=13/3">{ x + y = 7; 2x − y = 1 } → y = 7 − x → 2x − (7 − x) = 1 → 3x = 8 → x=8/3, y=13/3</code><button class="copy">Copiar</button></div>
              </details>
              <details><summary>Reducció</summary><p>Iguala coeficients amb signe contrari i suma/resta per eliminar.</p></details>
              <details><summary>Casos especials</summary><ul><li>Cap: rectes paral·leles.</li><li>Infinites: equacions equivalents.</li></ul></details>
            </article>

            <article class="card" style="margin-top:12px">
              <h3>4) Equacions amb fraccions</h3>
              <ol><li>Comú denominador</li><li>Multiplica per eliminar denominadors</li><li>Resol</li></ol>
              <details><summary>Exemple</summary><div class="formula-wrap"><code class="formula" data-copy="(x/6) + 1/3 = 5/6 → ×6 → x + 2 = 5 → x = 3">(x/6) + 1/3 = 5/6 → ×6 → x + 2 = 5 → x = 3</code><button class="copy">Copiar</button></div></details>
            </article>

            <article class="card" style="margin-top:12px">
              <h3>5) Equacions amb parèntesis</h3>
              <ol><li>Desenvolupa (distributiva)</li><li>Simplifica i agrupa</li><li>Resol</li></ol>
              <details><summary>Exemple</summary><div class="formula-wrap"><code class="formula" data-copy="2(x+3) − (x−4) = 10 → 2x+6 −x+4 = 10 → x+10=10 → x=0">2(x+3) − (x−4) = 10 → 2x+6 −x+4 = 10 → x+10=10 → x=0</code><button class="copy">Copiar</button></div></details>
            </article>
          </div>
        </section>

        <!-- POTÈNCIES I ARRELS -->
        <section class="topic" id="potencies">
          <div class="card">
            <h2>Potències i arrels</h2>
            <p class="subtitle">Regles d’exponents i arrels quadrades. Notació científica.</p>
            <div class="grid">
              <div class="col-6">
                <h3>Regles bàsiques</h3>
                <ul>
                  <li><b>Producte</b>: a^m · a^n = a^(m+n)</li>
                  <li><b>Quocient</b>: a^m / a^n = a^(m−n)</li>
                  <li><b>Potència de potència</b>: (a^m)^n = a^(m·n)</li>
                  <li><b>Producte elevat</b>: (ab)^n = a^n b^n</li>
                  <li><b>Exponent 0</b>: a^0 = 1 (a≠0)</li>
                  <li><b>Exponent negatiu</b>: a^(−n) = 1/a^n</li>
                </ul>
                <div class="formula-wrap"><code class="formula" data-copy="(2^3)·(2^4)=2^7; (3^5)/(3^2)=3^3">(2^3)·(2^4)=2^7; (3^5)/(3^2)=3^3</code><button class="copy">Copiar</button></div>
              </div>
              <div class="col-6">
                <h3>Arrels</h3>
                <ul>
                  <li>√(a^2)=|a| · √(ab)=√a·√b · √(a/b)=√a/√b</li>
                  <li>Arrel n-èsima: (a^(1/n))^n = a</li>
                </ul>
                <details open><summary>Exemple</summary><p>√180 = √(36·5) = 6√5</p></details>
                <h3>Notació científica</h3>
                <p>n = k · 10^m, amb 1 ≤ k &lt; 10.</p>
                <div class="formula-wrap"><code class="formula" data-copy="0,00045 = 4,5·10^-4">0,00045 = 4,5·10^-4</code><button class="copy">Copiar</button></div>
              </div>
            </div>
          </div>
        </section>

        <!-- PROPORCIONS I RAONS -->
        <section class="topic" id="proporcions">
          <div class="card">
            <h2>Proporcions i raons</h2>
            <p class="subtitle">Raó a:b, proporció a/b = c/d, regla de tres i percentatges avançats.</p>
            <div class="grid">
              <div class="col-6">
                <h3>Raons i proporcions</h3>
                <p>a:b = c:d ⇔ a/b = c/d ⇔ <b>producte en creu</b>: a·d = b·c</p>
                <div class="formula-wrap"><code class="formula" data-copy="si a/b = c/d → a·d = b·c">si a/b = c/d → a·d = b·c</code><button class="copy">Copiar</button></div>
                <details open><summary>Regla de tres simple</summary>
                  <p><i>Si</i> a → b, <i>llavors</i> x → y. <b>Directa</b>: x = (a·y)/b · <b>Inversa</b>: x = (a·b)/y</p>
                </details>
              </div>
              <div class="col-6">
                <h3>Percentatges compostos</h3>
                <p>Augments/descomptes successius: multiplica factors.</p>
                <div class="formula-wrap"><code class="formula" data-copy="Preu·(1+0,10)·(1−0,20)">Preu·(1+0,10)·(1−0,20)</code><button class="copy">Copiar</button></div>
                <details><summary>Escales i mapes</summary><p>Escala 1:k → distància real = dist. mapa · k</p></details>
              </div>
            </div>
          </div>
        </section>

        <!-- FUNCIONS LINEALS -->
        <section class="topic" id="funcions">
          <div class="card">
            <h2>Funcions lineals</h2>
            <p class="subtitle">Forma y = m·x + n, pendent, tall amb eix y, càlcul de recta per dos punts.</p>
            <div class="grid">
              <div class="col-6">
                <h3>Concepte</h3>
                <p>y = m·x + n · <span class="tag">m</span> pendent (variació) · <span class="tag">n</span> tall amb y.</p>
                <ul>
                  <li>m &gt; 0: creixent · m &lt; 0: decreixent · m = 0: horitzontal</li>
                  <li>Recta vertical: x = c</li>
                </ul>
                <div class="formula-wrap"><code class="formula" data-copy="m = (y2−y1)/(x2−x1)">m = (y2−y1)/(x2−x1)</code><button class="copy">Copiar</button></div>
              </div>
              <div class="col-6">
                <h3>Recta per dos punts</h3>
                <ol>
                  <li>Calcula m = (y2−y1)/(x2−x1)</li>
                  <li>y = m(x − x1) + y1 → transforma a y = m·x + n</li>
                </ol>
                <details open><summary>Exemple</summary>
                  <p>P1(1,2), P2(3,6) → m = 2 → y = 2(x−1)+2 = 2x</p>
                </details>
                <div class="formula-wrap"><code class="formula" data-copy="Distància punt-recta: |Ax0+By0+C|/√(A^2+B^2)">Distància punt-recta: |Ax0+By0+C|/√(A²+B²)</code><button class="copy">Copiar</button></div>
              </div>
            </div>
          </div>
        </section>

        <p class="footer">© <span id="year"></span> Biblioteca de Teoria — Fet amb ❤️ per facilitar l’aprenentatge</p>
      </div>
    </main>
  </div>

  <button class="top-btn" id="toTop" aria-label="Tornar a l'inici">▲</button>

  <script>
    // Any actual
    document.getElementById('year').textContent = new Date().getFullYear();

    // ===== Theme (FIX) =====
    const themeCheckbox = document.getElementById('theme');
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    const savedTheme = localStorage.getItem('theory-theme');
    const initialTheme = savedTheme || (prefersDark ? 'dark' : 'light');
    document.documentElement.setAttribute('data-theme', initialTheme);
    themeCheckbox.checked = initialTheme === 'dark';

    themeCheckbox.addEventListener('change', () => {
      const mode = themeCheckbox.checked ? 'dark' : 'light';
      document.documentElement.setAttribute('data-theme', mode);
      localStorage.setItem('theory-theme', mode);
    });

    // ===== Scroll spy (nav active) =====
    const navLinks = Array.from(document.querySelectorAll('nav a'));
    const sections = navLinks.map(a => document.querySelector(a.getAttribute('href'))).filter(Boolean);
    const spy = new IntersectionObserver((entries)=>{
      entries.forEach(e=>{
        if(e.isIntersecting){
          const id = '#' + e.target.id;
          navLinks.forEach(l => l.classList.toggle('active', l.getAttribute('href')===id));
        }
      });
    }, { rootMargin: '-40% 0px -55% 0px', threshold: 0 });
    sections.forEach(s => spy.observe(s));

    // ===== Back to top
    const btnTop = document.getElementById('toTop');
    window.addEventListener('scroll', ()=> btnTop.classList.toggle('show', window.scrollY > 320));
    btnTop.addEventListener('click', ()=> window.scrollTo({top:0, behavior:'smooth'}));

    // ===== Expand / Collapse all details (top bar)
    document.getElementById('expand').addEventListener('click', ()=> toggleDetails(true));
    document.getElementById('collapse').addEventListener('click', ()=> toggleDetails(false));

    // ===== Expand / Collapse from sidebar quick actions
    document.getElementById('expandSide').addEventListener('click', ()=> toggleDetails(true));
    document.getElementById('collapseSide').addEventListener('click', ()=> toggleDetails(false));

    function toggleDetails(open){ document.querySelectorAll('details').forEach(d=> d.open = open); }

    // ===== Global search (top bar)
    const input = document.getElementById('q');
    let lastMarks = [];
    input.addEventListener('input', ()=> runContentFilter(input.value));
    window.addEventListener('keydown', (e)=>{ if(e.key === '/' && document.activeElement !== input){ e.preventDefault(); input.focus(); }});

    function runContentFilter(q){
      const query = (q||'').trim().toLowerCase();
      clearMarks(); if(!query){ showAll(); return; }
      const cards = Array.from(document.querySelectorAll('section.topic .card'));
      cards.forEach(card=>{
        const text = card.innerText.toLowerCase();
        const match = text.includes(query);
        card.style.display = match ? '' : 'none';
        if(match){ highlight(card, query); }
      });
      // Manté la targeta principal de cada secció visible
      document.querySelectorAll('section.topic > .card:first-child').forEach(c=> c.style.display = '');
    }
    function showAll(){ document.querySelectorAll('section.topic .card').forEach(c=> c.style.display = '') }
    function highlight(root, q){
      const walker = document.createTreeWalker(root, NodeFilter.SHOW_TEXT, null);
      const nodes = []; while(walker.nextNode()) nodes.push(walker.currentNode);
      nodes.forEach(n=>{
        const s = n.nodeValue; const i = s.toLowerCase().indexOf(q);
        if(i>=0 && s.trim()){
          const mark = document.createElement('mark'); mark.className='hl'; mark.textContent = s.substr(i, q.length);
          const span = document.createElement('span');
          span.appendChild(document.createTextNode(s.substring(0,i)));
          span.appendChild(mark);
          span.appendChild(document.createTextNode(s.substring(i+q.length)));
          n.parentNode.replaceChild(span, n); lastMarks.push(mark);
        }
      });
    }
    function clearMarks(){
      lastMarks.forEach(m=>{
        const p = m.parentNode; if(!p) return;
        if(p.childNodes.length===3 && p.childNodes[0].nodeType===3 && p.childNodes[2].nodeType===3){
          const text = p.childNodes[0].nodeValue + p.childNodes[1].textContent + p.childNodes[2].nodeValue;
          p.replaceWith(document.createTextNode(text));
        } else { m.replaceWith(document.createTextNode(m.textContent)); }
      });
      lastMarks = [];
    }

    // ===== Sidebar filter (filter items in TOC)
    const tocFilter = document.getElementById('tocFilter');
    tocFilter.addEventListener('input', ()=>{
      const q = tocFilter.value.trim().toLowerCase();
      document.querySelectorAll('#toc li').forEach(li=>{
        const t = li.innerText.toLowerCase();
        li.style.display = t.includes(q) ? '' : 'none';
      });
    });
  </script>
</body>
</html>
