<!DOCTYPE html>
<html lang="ca">
<head>
<meta charset="utf-8">
<title>Mapa d'Europa · Joc de països</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" rel="stylesheet">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<style>
  html,body{margin:0;height:100%;font-family:system-ui;background:#f8fafc}
  #map{height:100%;width:100%}
  #hud{
    position:fixed;top:10px;left:50%;transform:translateX(-50%);
    background:white;padding:10px 16px;border-radius:12px;
    display:flex;gap:16px;align-items:center;
    box-shadow:0 4px 20px rgba(0,0,0,.15);z-index:1000
  }
  .pill{padding:4px 10px;border-radius:999px;font-weight:600}
  .ok{background:#dcfce7}.ko{background:#fee2e2}
  button{border:0;border-radius:8px;background:#e2e8f0;padding:8px 10px;cursor:pointer}
</style>
</head>
<body>
<div id="hud">
  <div><b>Troba:</b> <span id="ask">—</span></div>
  <div class="pill ok">✅ <span id="good">0</span></div>
  <div class="pill ko">❌ <span id="bad">0</span></div>
  <button id="again">🔄 Torna a començar</button>
</div>
<div id="map"></div>

<script>
const map=L.map('map',{preferCanvas:true}).setView([54,15],4);
L.tileLayer('https://cartodb-basemaps-a.global.ssl.fastly.net/light_nolabels/{z}/{x}/{y}.png',{
  maxZoom:8, attribution:'© OpenStreetMap · © CartoDB'
}).addTo(map);

const base={color:'#1e293b',weight:1.2,fillColor:'#bfdbfe',fillOpacity:0.55};
const hover={weight:2,fillOpacity:0.75};
const ok={fillColor:'#22c55e',fillOpacity:0.8};
const ko={fillColor:'#ef4444',fillOpacity:0.8};

let capa,features=[],objectiu=null,okCount=0,koCount=0;

const trad = {"Germany":"Alemanya","France":"França","Spain":"Espanya","Italy":"Itàlia","Portugal":"Portugal",
"Austria":"Àustria","Belgium":"Bèlgica","Netherlands":"Països Baixos","Switzerland":"Suïssa",
"Poland":"Polònia","Czech Republic":"República Txeca","Slovakia":"Eslovàquia","Slovenia":"Eslovènia",
"Hungary":"Hongria","Romania":"Romania","Bulgaria":"Bulgària","Greece":"Grècia","Croatia":"Croàcia",
"Serbia":"Sèrbia","Bosnia and Herz.":"Bòsnia i Hercegovina","Norway":"Noruega","Sweden":"Suècia",
"Finland":"Finlàndia","Denmark":"Dinamarca","Iceland":"Islàndia","Ireland":"Irlanda",
"United Kingdom":"Regne Unit","Estonia":"Estònia","Latvia":"Letònia","Lithuania":"Lituània",
"Ukraine":"Ucraïna","Belarus":"Bielorússia","Moldova":"Moldàvia","Andorra":"Andorra","Luxembourg":"Luxemburg",
"Monaco":"Mònaco","San Marino":"San Marino","Malta":"Malta","Vatican":"Vaticà","Liechtenstein":"Liechtenstein",
"Albania":"Albània","North Macedonia":"Macedònia del Nord","Montenegro":"Montenegro","Kosovo":"Kosovo",
"Turkey":"Turquia","Georgia":"Geòrgia","Armenia":"Armènia","Azerbaijan":"Azerbaidjan"};

function toCA(n){return trad[n]||n;}
function actualitzarMarcador(){
  document.getElementById('good').textContent=okCount;
  document.getElementById('bad').textContent=koCount;
}
function nouObjectiu(){
  if(features.length===0)return;
  objectiu=features[Math.floor(Math.random()*features.length)];
  document.getElementById('ask').textContent=toCA(objectiu.properties.name);
}

fetch('https://raw.githubusercontent.com/johan/world.geo.json/master/countries.geo.json')
.then(r=>r.json())
.then(world=>{
  // Filtra Europa
  world.features=world.features.filter(f=>{
    const b=L.geoJSON(f).getBounds();
    const c=b.getCenter();
    return c.lat>34 && c.lat<72 && c.lng>-25 && c.lng<45;
  });
  features=world.features;

  capa=L.geoJSON(world,{
    style:base,
    onEachFeature:(f,l)=>{
      l.on('mouseover',()=>l.setStyle(hover));
      l.on('mouseout',()=>capa.resetStyle(l));
      l.on('click',()=>{
        if(!objectiu)return;
        if(f.properties.name===objectiu.properties.name){
          l.setStyle(ok); okCount++;
        }else{
          l.setStyle(ko); koCount++;
        }
        actualitzarMarcador();
        nouObjectiu();
      });
    }
  }).addTo(map);

  map.fitBounds(capa.getBounds());
  // Mostra el primer país un cop la capa està al mapa
  capa.once('load',nouObjectiu);
  // O per seguretat després d’un breu retard
  setTimeout(()=>nouObjectiu(),1000);
})
.catch(e=>alert("Error en carregar el mapa: "+e));

document.getElementById('again').onclick=()=>{
  okCount=koCount=0;
  actualitzarMarcador();
  capa.eachLayer(l=>capa.resetStyle(l));
  nouObjectiu();
};
</script>
</body>
</html>
