<!DOCTYPE html>
<html lang="ca">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Focus Academy ¬∑ Gestor de tasques Supabase</title>
  <link rel="stylesheet" href="../style.css" />
  <link rel="stylesheet" href="./portal.css" />
</head>
<body>
  <header class="topbar">
    <div class="wrap row header-bar">
      <div class="brand">
        <div class="logo">FQ</div>
        <h1>Focus Academy</h1>
      </div>
      <nav class="main-nav" aria-label="Navegaci√≥ principal">
        <a class="pill" href="../index.html">üè† Inici</a>
        <a class="pill" href="../capsules.html">üéì C√†psules</a>
        <a class="pill" href="./supabase-portal.html" aria-current="page">Acc√©s professor/alumne</a>
      </nav>
    </div>
  </header>

  <main class="wrap portal-main">
    <section class="panel card portal-hero">
      <h1>Gestor de tasques (Supabase)</h1>
      <p class="subtitle">Autentica't amb el teu compte per gestionar assignacions entre mestres i alumnes amb la mateixa experi√®ncia FocusQuiz.</p>
      <div id="configWarning" class="portal-alert hidden">Configura les claus Supabase a <code>SUPABASE_URL</code> i <code>SUPABASE_ANON_KEY</code> mitjan√ßant variables d'entorn.</div>
    </section>

    <section id="authPanel" class="panel card">
      <h2 style="margin-bottom:0.75rem">Inicia sessi√≥</h2>
      <form id="loginForm" class="portal-form" autocomplete="on">
        <label>
          <span class="portal-field-label">Correu electr√≤nic</span>
          <input class="input" name="email" type="email" required placeholder="docent@centre.cat" autocomplete="username" />
        </label>
        <label>
          <span class="portal-field-label">Contrasenya</span>
          <input class="input" name="password" type="password" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password" />
        </label>
        <button class="btn-primary" type="submit">Entrar</button>
      </form>
      <p class="portal-muted" style="margin-top:0.75rem">Els comptes s'han de crear pr√®viament a Supabase Auth.</p>
      <div id="authError" class="portal-error hidden"></div>
    </section>

    <section id="sessionPanel" class="panel card hidden">
      <div class="portal-section-header">
        <div>
          <p class="portal-section-title" style="margin-bottom:0">Sessi√≥ iniciada</p>
          <h2 style="margin:0" id="sessionName"></h2>
          <p id="sessionRole" class="portal-muted" style="margin-top:0.25rem"></p>
        </div>
        <button id="logoutBtn" class="btn-secondary" type="button">Tanca la sessi√≥</button>
      </div>
    </section>

    <section id="teacherView" class="panel card hidden">
      <h2>Panell de mestre/a</h2>
      <p class="portal-muted">Tria els m√≤duls FocusQuiz i defineix una prova autom√†tica per a l'alumnat seleccionat.</p>
      <form id="assignmentForm" class="portal-form" style="margin-top:1rem">
        <section class="portal-module-section">
          <div class="portal-section-header" style="align-items:flex-start; gap:0.75rem;">
            <div>
              <p class="portal-section-title" style="margin-bottom:0.35rem">Selecciona m√≤duls per convertir-los en proves</p>
              <p class="portal-muted" style="margin:0">Pots triar diversos m√≤duls a la vegada. Cada m√≤dul generar√† una prova independent amb la mateixa configuraci√≥.</p>
            </div>
            <span id="moduleSelectedInfo" class="portal-chip portal-chip--muted">Cap prova seleccionada</span>
          </div>
          <div class="portal-module-toolbar">
            <label class="chip portal-chip-input">
              Categoria
              <select id="moduleFilter" class="input"></select>
            </label>
            <label class="chip portal-chip-input">
              Cerca
              <input id="moduleSearch" class="input" type="search" placeholder="Escriu per filtrar m√≤duls" />
            </label>
          </div>
          <div id="modulePicker" class="portal-module-grid" role="listbox" aria-multiselectable="true"></div>
          <p id="moduleEmptyState" class="portal-muted portal-module-empty hidden">Cap m√≤dul coincideix amb la cerca o el filtre aplicat.</p>
          <section id="moduleConfigPanel" class="portal-module-config hidden" aria-live="polite">
            <p class="portal-section-title" style="margin-bottom:0.35rem">Detalla els subtemes de cada prova</p>
            <p class="portal-muted" style="margin-top:0; margin-bottom:0.75rem;">Configura les opcions espec√≠fiques de cada m√≤dul perqu√® l'alumne rebi exactament la mateixa prova que prepararies des del configurador principal.</p>
            <div id="moduleConfigList" class="portal-module-config-list"></div>
          </section>
        </section>
        <section class="portal-quiz-section">
          <div class="portal-section-header" style="align-items:flex-start; gap:0.75rem;">
            <div>
              <p class="portal-section-title" style="margin-bottom:0.35rem">Configura la prova autom√†tica</p>
              <p class="portal-muted" style="margin:0">Aquests par√†metres s'aplicaran a totes les proves creades amb la selecci√≥ anterior.</p>
            </div>
          </div>
          <div class="portal-quiz-grid">
            <label>
              <span class="portal-field-label">Nom de la prova (opcional)</span>
              <input class="input" name="quiz_title" type="text" maxlength="120" placeholder="Per exemple: Prova inicial de morfologia" />
            </label>
            <label>
              <span class="portal-field-label">Nombre de preguntes</span>
              <input class="input" name="quiz_count" type="number" min="1" max="200" value="10" required />
            </label>
            <label>
              <span class="portal-field-label">Temps l√≠mit (minuts)</span>
              <input class="input" name="quiz_time" type="number" min="0" max="180" value="0" required />
            </label>
            <label>
              <span class="portal-field-label">Nivell (1‚Äì4)</span>
              <select class="input" name="quiz_level" required>
                <option value="1" selected>1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
              </select>
            </label>
          </div>
          <p class="portal-muted" style="margin-top:0.35rem">Si un m√≤dul no utilitza nivells o l√≠mit de temps, s'ignorar√† autom√†ticament.</p>
        </section>
        <section class="portal-quiz-section">
          <div class="portal-section-header" style="align-items:flex-start; gap:0.75rem;">
            <div>
              <p class="portal-section-title" style="margin-bottom:0.35rem">Configura la prova autom√†tica</p>
              <p class="portal-muted" style="margin:0">Aquests par√†metres s'aplicaran a totes les proves creades amb la selecci√≥ anterior.</p>
            </div>
          </div>
          <div class="portal-quiz-grid">
            <label>
              <span class="portal-field-label">Nom de la prova (opcional)</span>
              <input class="input" name="quiz_title" type="text" maxlength="120" placeholder="Per exemple: Prova inicial de morfologia" />
            </label>
            <label>
              <span class="portal-field-label">Nombre de preguntes</span>
              <input class="input" name="quiz_count" type="number" min="1" max="200" value="10" required />
            </label>
            <label>
              <span class="portal-field-label">Temps l√≠mit (minuts)</span>
              <input class="input" name="quiz_time" type="number" min="0" max="180" value="0" required />
            </label>
            <label>
              <span class="portal-field-label">Nivell (1‚Äì4)</span>
              <select class="input" name="quiz_level" required>
                <option value="1" selected>1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
              </select>
            </label>
          </div>
          <p class="portal-muted" style="margin-top:0.35rem">Si un m√≤dul no utilitza nivells o l√≠mit de temps, s'ignorar√† autom√†ticament.</p>
        </section>
        <label>
          <span class="portal-field-label">Data l√≠mit</span>
          <input class="input" name="due_date" type="date" />
        </label>
        <label>
          <span class="portal-field-label">Comentaris addicionals (opcional)</span>
          <textarea class="input" name="note" rows="3" placeholder="Instruccions extra per a l'alumnat..."></textarea>
        </label>
        <section>
          <p class="portal-section-title" style="margin-bottom:0.5rem">Selecciona alumnes per assignar la tasca</p>
          <div id="studentChecklist" class="portal-assignees"></div>
        </section>
        <div class="portal-actions">
          <button class="btn-primary" type="submit">Assigna les proves</button>
          <button class="btn-secondary" type="button" id="refreshStudents">Actualitza alumnes</button>
        </div>
      </form>
      <div id="assignmentFeedback" class="portal-success hidden" style="margin-top:1rem"></div>
      <div id="assignmentError" class="portal-error hidden" style="margin-top:1rem"></div>
    </section>

    <section id="teacherAssignments" class="panel card hidden">
      <div class="portal-section-header">
        <h2 style="margin:0">Assignacions publicades</h2>
        <button id="reloadAssignments" type="button" class="btn-secondary">Actualitza llistat</button>
      </div>
      <div id="assignmentList" class="portal-list list" aria-live="polite"></div>
    </section>

    <section id="studentView" class="panel card hidden">
      <h2>Panell d'alumne/a</h2>
      <p class="portal-muted">Consulta les tasques assignades i marca el progr√©s.</p>
      <div id="studentAssignmentList" class="portal-list list" aria-live="polite"></div>
    </section>
  </main>

  <script type="module" src="./supabase-portal.js"></script>
</body>
</html>
