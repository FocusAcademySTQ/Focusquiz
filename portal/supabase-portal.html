<!DOCTYPE html>
<html lang="ca">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Focus Academy ¬∑ Gestor de proves</title>
  <link rel="stylesheet" href="../style.css" />
  <link rel="stylesheet" href="./portal.css" />
</head>
<body>
  <header class="topbar">
    <div class="wrap row header-bar">
      <div class="brand">
        <div class="logo">FQ</div>
        <h1>Focus Academy</h1>
      </div>
      <nav class="main-nav" aria-label="Navegaci√≥ principal">
        <a class="pill" href="../index.html">üè† Inici</a>
        <a class="pill" href="../capsules.html">üéì C√†psules</a>
        <a class="pill" href="./supabase-portal.html" aria-current="page">Acc√©s professorat</a>
      </nav>
    </div>
  </header>

  <main class="wrap portal-main">
    <section class="panel card portal-hero">
      <h1>Gestiona classes, proves i notes</h1>
      <p class="subtitle">
        Crea una classe amb els alumnes, assigna qualsevol m√≤dul FocusQuiz i comparteix el codi perqu√® l'alumnat faci la prova sense
        registrar-se.
      </p>
      <div id="configWarning" class="portal-alert hidden">
        Configura les claus Supabase a <code>SUPABASE_URL</code> i <code>SUPABASE_ANON_KEY</code> mitjan√ßant variables d'entorn.
      </div>
    </section>

    <section id="authPanel" class="panel card">
      <h2 style="margin-bottom:0.75rem">Inicia sessi√≥ com a docent</h2>
      <form id="loginForm" class="portal-form" autocomplete="on">
        <label>
          <span class="portal-field-label">Correu electr√≤nic</span>
          <input class="input" name="email" type="email" required placeholder="docent@centre.cat" autocomplete="username" />
        </label>
        <label>
          <span class="portal-field-label">Contrasenya</span>
          <input class="input" name="password" type="password" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password" />
        </label>
        <button class="btn-primary" type="submit">Entrar</button>
      </form>
      <div id="authError" class="portal-error hidden"></div>
    </section>

    <section id="registerPanel" class="panel card">
      <h2 style="margin-bottom:0.75rem">Encara no tens compte docent?</h2>
      <p class="portal-muted" style="margin-top:0; margin-bottom:1rem;">
        Registra't amb el teu correu de centre. Nom√©s el professorat pot accedir al gestor de classes.
      </p>
      <form id="signupForm" class="portal-form portal-form--two" autocomplete="on">
        <label>
          <span class="portal-field-label">Nom i cognoms</span>
          <input class="input" name="full_name" type="text" required placeholder="Nom complet" autocomplete="name" />
        </label>
        <label>
          <span class="portal-field-label">Correu professional</span>
          <input class="input" name="signup_email" type="email" required placeholder="docent@centre.cat" autocomplete="email" />
        </label>
        <label>
          <span class="portal-field-label">Contrasenya</span>
          <input class="input" name="signup_password" type="password" minlength="6" required placeholder="Almenys 6 car√†cters" autocomplete="new-password" />
        </label>
        <div class="portal-actions" style="margin-top:0.5rem;">
          <button class="btn-secondary" type="submit">Crear compte docent</button>
        </div>
      </form>
      <div id="signupSuccess" class="portal-success hidden" role="status" aria-live="polite" style="margin-top:1rem"></div>
      <div id="signupError" class="portal-error hidden" role="alert" style="margin-top:1rem"></div>
    </section>

    <section id="sessionPanel" class="panel card hidden">
      <div class="portal-section-header">
        <div>
          <p class="portal-section-title" style="margin-bottom:0">Sessi√≥ docent</p>
          <h2 style="margin:0" id="sessionName"></h2>
          <p id="sessionEmail" class="portal-muted" style="margin-top:0.25rem"></p>
        </div>
        <button id="logoutBtn" class="btn-secondary" type="button">Tanca la sessi√≥</button>
      </div>
      <div id="sessionWarning" class="portal-error hidden" role="status" aria-live="polite" style="margin-top:0.75rem"></div>
    </section>

    <div id="portalTabs" class="portal-tabs hidden" data-portal-tablist role="tablist" aria-label="Eines del professorat">
      <button id="tab-classes" class="portal-tab" type="button" data-tab="classes" role="tab" aria-controls="classesPanel" aria-selected="false">Classes</button>
      <button id="tab-assignments" class="portal-tab" type="button" data-tab="assignments" role="tab" aria-controls="assignmentsPanel" aria-selected="false">Assignacions</button>
      <button id="tab-results" class="portal-tab" type="button" data-tab="results" role="tab" aria-controls="resultsPanel" aria-selected="false">Resultats</button>
    </div>

    <section id="classesPanel" class="portal-tabpanel hidden" data-tab-panel="classes" role="tabpanel" aria-labelledby="tab-classes">
      <section class="panel card">
        <div class="portal-section-header">
          <div>
            <p class="portal-section-title">Nova classe</p>
            <h2>Crea una classe i afegeix l'alumnat</h2>
          </div>
          <button id="refreshClasses" class="btn-ghost" type="button">Actualitza</button>
        </div>
        <form id="classCreateForm" class="portal-form portal-form--two">
          <label>
            <span class="portal-field-label">Nom de la classe</span>
            <input class="input" name="class_name" type="text" required placeholder="4t ESO ¬∑ Matem√†tiques" />
          </label>
          <label class="portal-form--stack">
            <span class="portal-field-label">Alumnes (un per l√≠nia)</span>
            <textarea class="input" name="student_list" rows="6" placeholder="Nom alumne 1&#10;Nom alumne 2&#10;..."></textarea>
            <span class="portal-field-hint">No cal correu ni contrasenya. Els alumnes s'identifiquen amb el seu nom.</span>
          </label>
          <div class="portal-actions">
            <button class="btn-primary" type="submit">Crear classe</button>
            <div id="classCreateFeedback" class="portal-muted" role="status" aria-live="polite"></div>
          </div>
        </form>
      </section>

      <section class="panel card">
        <div class="portal-section-header">
          <h2>Les meves classes</h2>
          <p class="portal-muted">Copia el codi o enlla√ß i comparteix-lo amb l'alumnat.</p>
        </div>
        <div id="classList" class="portal-grid"></div>
        <div id="classEmptyState" class="portal-empty hidden">
          <p>Encara no has creat cap classe. Afegeix-ne una amb el formulari superior.</p>
        </div>
      </section>
    </section>

    <section id="assignmentsPanel" class="portal-tabpanel hidden" data-tab-panel="assignments" role="tabpanel" aria-labelledby="tab-assignments">
      <section class="panel card">
        <div class="portal-section-header">
          <div>
            <p class="portal-section-title">Publica una prova</p>
            <h2>Escull un m√≤dul i configura la prova</h2>
          </div>
          <div class="portal-actions">
            <button id="previewModule" class="btn-ghost" type="button">Previsualitza l'examen</button>
            <button id="refreshAssignments" class="btn-ghost" type="button">Actualitza</button>
          </div>
        </div>
        <form id="assignmentCreateForm" class="portal-form">
          <div class="portal-assignment-grid">
            <div class="portal-assignment-grid__fields portal-form portal-form--two">
              <label>
                <span class="portal-field-label">Classe</span>
                <select class="input" name="class_id" id="assignmentClass" required></select>
              </label>
              <label>
                <span class="portal-field-label">M√≤dul FocusQuiz</span>
                <select class="input" name="module_id" id="assignmentModule" required></select>
              </label>
              <label>
                <span class="portal-field-label">Nom visible per a l'alumnat</span>
                <input class="input" name="assignment_label" type="text" placeholder="Control de fraccions" />
              </label>
            </div>
            <div id="moduleConfig" class="portal-module-config hidden" aria-live="polite">
              <article class="portal-module-config-card" id="moduleConfigCard">
                <div class="portal-module-config-header">
                  <div>
                    <h3 id="moduleConfigTitle">Opcions espec√≠fiques</h3>
                    <p class="portal-chip portal-chip--muted" id="moduleConfigKicker">Personalitza el m√≤dul</p>
                  </div>
                  <button id="resetModuleConfig" class="btn-ghost" type="button">Reinicia opcions</button>
                </div>
                <div id="moduleConfigBody" class="portal-module-config-content"></div>
                <p id="moduleConfigSummary" class="portal-module-config-summary hidden"></p>
                <p id="moduleConfigError" class="portal-error hidden" role="status"></p>
              </article>
              <p id="moduleConfigNotice" class="portal-muted hidden"></p>
            </div>
          </div>
          <div class="portal-form portal-form--three">
            <label>
              <span class="portal-field-label">Preguntes</span>
              <input class="input" name="count" type="number" min="1" max="200" value="20" />
            </label>
            <label>
              <span class="portal-field-label">Temps (minuts)</span>
              <input class="input" name="time" type="number" min="0" max="180" value="0" />
            </label>
            <label>
              <span class="portal-field-label">Nivell (1-4)</span>
              <input class="input" name="level" type="number" min="1" max="4" value="1" />
            </label>
          </div>
          <label>
            <span class="portal-field-label">Data l√≠mit (opcional)</span>
            <input class="input" name="due_at" type="datetime-local" />
          </label>
          <label class="portal-form--stack">
            <span class="portal-field-label">Notes internes</span>
            <textarea class="input" name="notes" rows="3" placeholder="Anota criteris o instruccions per recordar-les"></textarea>
          </label>
          <div class="portal-actions">
            <button class="btn-primary" type="submit">Publica la prova</button>
            <div id="assignmentFeedback" class="portal-muted" role="status" aria-live="polite"></div>
          </div>
        </form>
      </section>

      <section class="panel card">
        <div class="portal-section-header">
          <h2>Assignacions actives</h2>
          <p class="portal-muted">Consulta l'estat de cada prova i copia l'enlla√ß d'aula.</p>
        </div>
        <div id="assignmentList" class="portal-grid"></div>
        <div id="assignmentEmptyState" class="portal-empty hidden">
          <p>Encara no hi ha proves publicades. Crea'n una amb el formulari superior.</p>
        </div>
      </section>
    </section>

    <section id="resultsPanel" class="portal-tabpanel hidden" data-tab-panel="results" role="tabpanel" aria-labelledby="tab-results">
      <section class="panel card">
        <div class="portal-section-header">
          <div>
            <p class="portal-section-title">Resultats en directe</p>
            <h2>Corregeix i descarrega les notes</h2>
          </div>
          <div class="portal-actions">
            <button id="refreshResults" class="btn-ghost" type="button">Actualitza</button>
          </div>
        </div>
        <div id="resultsFilters" class="portal-form portal-form--two">
          <label>
            <span class="portal-field-label">Filtra per classe</span>
            <select class="input" id="resultsClassFilter"></select>
          </label>
          <label>
            <span class="portal-field-label">Filtra per prova</span>
            <select class="input" id="resultsAssignmentFilter"></select>
          </label>
        </div>
        <div class="portal-results">
          <div id="resultsList" class="portal-results-table-area"></div>
          <aside id="resultsDetail" class="portal-result-detail hidden" aria-live="polite"></aside>
        </div>
        <div id="resultsEmptyState" class="portal-empty hidden">
          <p>Encara no hi ha cap resultat registrat. Quan l'alumnat envi√Ø la prova apareixer√† aqu√≠ autom√†ticament.</p>
        </div>
      </section>
    </section>
  </main>

  <template id="classCardTemplate">
    <article class="portal-class-card">
      <header>
        <p class="portal-chip portal-chip--muted">Classe</p>
        <h3 class="portal-class-name"></h3>
      </header>
      <dl class="portal-class-meta"></dl>
      <div class="portal-class-actions">
        <button class="pill portal-class-copy" type="button">Copia enlla√ß</button>
        <button class="btn-secondary portal-class-edit" type="button">Gestiona alumnes</button>
        <button class="btn-ghost portal-class-delete" type="button">Elimina</button>
      </div>
      <details class="portal-class-roster">
        <summary>Llista d'alumnes</summary>
        <form class="portal-class-roster-form">
          <textarea class="input" rows="6"></textarea>
          <div class="portal-actions">
            <button class="btn-secondary" type="submit">Actualitza llista</button>
            <span class="portal-muted portal-class-feedback"></span>
          </div>
        </form>
      </details>
    </article>
  </template>

  <template id="assignmentCardTemplate">
    <article class="portal-assignment-card">
      <header>
        <p class="portal-chip portal-chip--muted assignment-class"></p>
        <h3 class="assignment-title"></h3>
      </header>
      <dl class="assignment-meta"></dl>
      <footer>
        <button class="pill assignment-copy" type="button">Copia enlla√ß</button>
        <button class="btn-secondary assignment-close" type="button">Tanca prova</button>
        <button class="btn-ghost assignment-delete" type="button">Elimina</button>
      </footer>
    </article>
  </template>

  <template id="resultDetailTemplate">
    <article class="portal-result-card">
      <header class="result-detail-header">
        <div class="result-detail-heading">
          <p class="portal-chip portal-chip--muted result-detail-class"></p>
          <h3 class="result-detail-assignment"></h3>
          <p class="portal-muted result-detail-meta"></p>
        </div>
        <span class="result-detail-grade"></span>
      </header>
      <div class="result-body">
        <h3 class="result-student"></h3>
        <dl class="result-details"></dl>
        <div class="result-extra hidden"></div>
      </div>
      <footer class="result-actions">
        <div class="portal-actions">
          <button class="btn-secondary result-edit" type="button">Edita nota</button>
          <button class="btn-ghost result-reset" type="button">Permet reintent</button>
        </div>
      </footer>
    </article>
  </template>

  <script type="module" src="./supabase-config.js"></script>
  <script type="module" src="./supabase-portal.js"></script>
</body>
</html>
