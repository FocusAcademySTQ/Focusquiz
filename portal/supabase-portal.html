<!DOCTYPE html>
<html lang="ca">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Focus Academy ¬∑ Gestor de tasques</title>
  <link rel="stylesheet" href="../style.css" />
  <link rel="stylesheet" href="./portal.css" />
</head>
<body>
  <header class="topbar">
    <div class="wrap row header-bar">
      <div class="brand">
        <div class="logo">FQ</div>
        <h1>Focus Academy</h1>
      </div>
      <nav class="main-nav" aria-label="Navegaci√≥ principal">
        <a class="pill" href="../index.html">üè† Inici</a>
        <a class="pill" href="../capsules.html">üéì C√†psules</a>
        <a class="pill" href="./supabase-portal.html" aria-current="page">Acc√©s professor/alumne</a>
      </nav>
    </div>
  </header>

  <main class="wrap portal-main">
    <section class="panel card portal-hero">
      <div class="portal-hero__badge">Nova experi√®ncia</div>
      <h1>Gestor de tasques</h1>
      <p class="subtitle">Connecta mestres i alumnat amb un espai m√©s visual, r√†pid i amb notificacions autom√†tiques de resultats.</p>
      <div id="configWarning" class="portal-alert hidden">Configura les claus base a <code>BASE_URL</code> i <code>BASE_ANON_KEY</code> mitjan√ßant variables d'entorn.</div>
    </section>

    <section id="authPanel" class="panel card">
      <h2 style="margin-bottom:0.75rem">Inicia sessi√≥</h2>
      <form id="loginForm" class="portal-form" autocomplete="on">
        <label>
          <span class="portal-field-label">Correu electr√≤nic</span>
          <input class="input" name="email" type="email" required placeholder="docent@centre.cat" autocomplete="username" />
        </label>
        <label>
          <span class="portal-field-label">Contrasenya</span>
          <input class="input" name="password" type="password" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password" />
        </label>
        <button class="btn-primary" type="submit">Entrar</button>
      </form>
      <p class="portal-muted" style="margin-top:0.75rem">Si no tens compte encara, utilitza el formulari de registre seg√ºent.</p>
      <div id="authError" class="portal-error hidden"></div>
    </section>

    <section id="registerPanel" class="panel card">
      <h2 style="margin-bottom:0.75rem">Encara no tens compte?</h2>
      <p class="portal-muted" style="margin-top:0; margin-bottom:1rem;">Registra't i rebr√†s un correu de confirmaci√≥. Per als comptes docents cal un codi de centre facilitat per l'equip.</p>
      <form id="signupForm" class="portal-form portal-form--two" autocomplete="on">
        <label>
          <span class="portal-field-label">Nom i cognoms</span>
          <input class="input" name="full_name" type="text" required placeholder="Nom complet" autocomplete="name" />
        </label>
        <label>
          <span class="portal-field-label">Correu electr√≤nic</span>
          <input class="input" name="signup_email" type="email" required placeholder="alumne@centre.cat" autocomplete="email" />
        </label>
        <label>
          <span class="portal-field-label">Contrasenya</span>
          <input class="input" name="signup_password" type="password" minlength="6" required placeholder="Almenys 6 car√†cters" autocomplete="new-password" />
        </label>
        <fieldset class="portal-radio-group">
          <legend class="portal-field-label" style="margin-bottom:0.35rem;">Rol a la plataforma</legend>
          <label>
            <input type="radio" name="signup_role" value="student" checked /> Alumne/a
          </label>
          <label>
            <input type="radio" name="signup_role" value="teacher" /> Mestre/a
          </label>
        </fieldset>
        <label class="hidden" data-signup-role="teacher">
          <span class="portal-field-label">Codi de centre</span>
          <input
            class="input"
            name="signup_teacher_code"
            type="text"
            inputmode="numeric"
            autocomplete="off"
            placeholder="Introdueix el codi de centre"
          />
          <span class="portal-field-hint">Nom√©s el professorat autoritzat pot utilitzar aquest codi.</span>
        </label>
        <div class="portal-actions" style="margin-top:0.5rem;">
          <button class="btn-secondary" type="submit">Crear compte</button>
        </div>
      </form>
      <div id="signupSuccess" class="portal-success hidden" role="status" aria-live="polite" style="margin-top:1rem"></div>
      <div id="signupError" class="portal-error hidden" role="alert" style="margin-top:1rem"></div>
    </section>

    <section id="sessionPanel" class="panel card hidden">
      <div class="portal-section-header">
        <div>
          <p class="portal-section-title" style="margin-bottom:0">Sessi√≥ iniciada</p>
          <h2 style="margin:0" id="sessionName"></h2>
          <p id="sessionRole" class="portal-muted" style="margin-top:0.25rem"></p>
        </div>
        <button id="logoutBtn" class="btn-secondary" type="button">Tanca la sessi√≥</button>
      </div>
      <div id="sessionWarning" class="portal-error hidden" role="status" aria-live="polite" style="margin-top:0.75rem"></div>
    </section>

    <div id="portalTabs" class="portal-tabs hidden" data-portal-tablist role="tablist" aria-label="Canvia de vista">
      <button id="tab-teacher" class="portal-tab" type="button" data-tab="teacher" role="tab" aria-controls="teacherPanel" aria-selected="false">Professorat</button>
      <button id="tab-student" class="portal-tab" type="button" data-tab="student" role="tab" aria-controls="studentPanel" aria-selected="false">Alumnat</button>
    </div>

    <section id="teacherPanel" class="portal-tabpanel hidden" data-tab-panel="teacher" role="tabpanel" aria-labelledby="tab-teacher">
      <div id="teacherTabs" class="portal-subtabs hidden" data-teacher-tablist role="tablist" aria-label="Vistes del professorat">
        <button
          id="teacher-tab-planner"
          class="portal-subtab"
          type="button"
          data-teacher-tab="planner"
          role="tab"
          aria-controls="teacherPlannerPanel"
          aria-selected="false"
        >Panell del mestre</button>
        <button
          id="teacher-tab-reports"
          class="portal-subtab"
          type="button"
          data-teacher-tab="reports"
          role="tab"
          aria-controls="teacherReportsPanel"
          aria-selected="false"
        >Assignacions i notes</button>
        <button
          id="teacher-tab-students"
          class="portal-subtab"
          type="button"
          data-teacher-tab="students"
          role="tab"
          aria-controls="teacherStudentsPanel"
          aria-selected="false"
        >Gesti√≥ d'alumnes</button>
      </div>

      <section
        id="teacherPlannerPanel"
        class="portal-subpanel hidden"
        data-teacher-panel="planner"
        role="tabpanel"
        aria-labelledby="teacher-tab-planner"
      >
        <section id="teacherView" class="panel card">
          <h2>Panell de mestre/a</h2>
          <p class="portal-muted">Tria els m√≤duls FocusQuiz i defineix una prova autom√†tica per a l'alumnat seleccionat.</p>
          <form id="assignmentForm" class="portal-form" style="margin-top:1rem">
            <section class="portal-module-section">
              <div class="portal-section-header" style="align-items:flex-start; gap:0.75rem;">
                <div>
                  <p class="portal-section-title" style="margin-bottom:0.35rem">Selecciona m√≤duls per convertir-los en proves</p>
                  <p class="portal-muted" style="margin:0">Pots triar diversos m√≤duls a la vegada. Cada m√≤dul generar√† una prova independent amb la mateixa configuraci√≥.</p>
                </div>
                <span id="moduleSelectedInfo" class="portal-chip portal-chip--muted">Cap prova seleccionada</span>
              </div>
              <div class="portal-module-toolbar">
                <label class="chip portal-chip-input">
                  Categoria
                  <select id="moduleFilter" class="input"></select>
                </label>
                <label class="chip portal-chip-input">
                  Cerca
                  <input id="moduleSearch" class="input" type="search" placeholder="Escriu per filtrar m√≤duls" />
                </label>
              </div>
              <div id="modulePicker" class="portal-module-grid" role="listbox" aria-multiselectable="true"></div>
              <p id="moduleEmptyState" class="portal-muted portal-module-empty hidden">Cap m√≤dul coincideix amb la cerca o el filtre aplicat.</p>
              <section id="moduleConfigPanel" class="portal-module-config hidden" aria-live="polite">
                <p class="portal-section-title" style="margin-bottom:0.35rem">Detalla els subtemes de cada prova</p>
                <p class="portal-muted" style="margin-top:0; margin-bottom:0.75rem;">Configura les opcions espec√≠fiques de cada m√≤dul perqu√® l'alumne rebi exactament la mateixa prova que prepararies des del configurador principal.</p>
                <div id="moduleConfigList" class="portal-module-config-list"></div>
              </section>
            </section>
            <section class="portal-quiz-section">
              <div class="portal-section-header" style="align-items:flex-start; gap:0.75rem;">
                <div>
                  <p class="portal-section-title" style="margin-bottom:0.35rem">Configura la prova autom√†tica</p>
                  <p class="portal-muted" style="margin:0">Aquests par√†metres s'aplicaran a totes les proves creades amb la selecci√≥ anterior.</p>
                </div>
              </div>
              <div class="portal-quiz-grid">
                <label>
                  <span class="portal-field-label">Nom de la prova (opcional)</span>
                  <input class="input" name="quiz_title" type="text" maxlength="120" placeholder="Per exemple: Prova inicial de morfologia" />
                </label>
                <label>
                  <span class="portal-field-label">Nombre de preguntes</span>
                  <input class="input" name="quiz_count" type="number" min="1" max="200" value="10" required />
                </label>
                <label>
                  <span class="portal-field-label">Temps l√≠mit (minuts)</span>
                  <input class="input" name="quiz_time" type="number" min="0" max="180" value="0" required />
                </label>
                <label>
                  <span class="portal-field-label">Nivell (1‚Äì4)</span>
                  <select class="input" name="quiz_level" required>
                    <option value="1" selected>1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                  </select>
                </label>
              </div>
              <p class="portal-muted" style="margin-top:0.35rem">Si un m√≤dul no utilitza nivells o l√≠mit de temps, s'ignorar√† autom√†ticament.</p>
            </section>
            <label>
              <span class="portal-field-label">Data l√≠mit</span>
              <input class="input" name="due_date" type="date" />
            </label>
            <section class="portal-student-selector">
              <div class="portal-section-header" style="align-items:flex-start; gap:0.75rem;">
                <div>
                  <p class="portal-section-title" style="margin-bottom:0.35rem">Selecciona alumnes per assignar la tasca</p>
                  <p class="portal-muted" style="margin:0">Filtra per grup per activar r√†pidament tota una classe.</p>
                </div>
                <span id="studentSelectionCount" class="portal-chip portal-chip--muted">Cap alumne seleccionat</span>
              </div>
              <div id="studentGroupFilter" class="portal-group-chips" role="group" aria-label="Filtra per grup"></div>
              <div id="studentChecklist" class="portal-assignees"></div>
            </section>
            <div class="portal-actions">
              <button class="btn-primary" type="submit">Assigna les proves</button>
              <button class="btn-secondary" type="button" id="refreshStudents">Actualitza alumnes</button>
            </div>
          </form>
          <div id="assignmentFeedback" class="portal-success hidden" style="margin-top:1rem"></div>
          <div id="assignmentError" class="portal-error hidden" style="margin-top:1rem"></div>
        </section>
      </section>

      <section
        id="teacherReportsPanel"
        class="portal-subpanel hidden"
        data-teacher-panel="reports"
        role="tabpanel"
        aria-labelledby="teacher-tab-reports"
      >
        <div class="portal-teacher-columns">
          <section id="teacherAssignments" class="panel card">
            <div class="portal-section-header">
              <h2 style="margin:0">Assignacions publicades</h2>
              <button id="reloadAssignments" type="button" class="btn-secondary">Actualitza llistat</button>
            </div>
            <div id="assignmentList" class="portal-list list" aria-live="polite"></div>
          </section>

          <section id="teacherGrades" class="panel card">
            <div class="portal-section-header" style="align-items:flex-start; gap:0.75rem;">
              <div>
                <p class="portal-section-title" style="margin-bottom:0.35rem">Resultats rebuts</p>
                <h2 style="margin:0">Notes dels alumnes</h2>
                <p class="portal-muted" style="margin-top:0.35rem;">Consulta les darreres entregues i la nota assignada autom√†ticament.</p>
              </div>
              <button id="refreshGrades" type="button" class="btn-secondary">Actualitza notes</button>
            </div>
            <div id="teacherGradesList" class="portal-feed"></div>
          </section>
        </div>
      </section>

      <section
        id="teacherStudentsPanel"
        class="portal-subpanel hidden"
        data-teacher-panel="students"
        role="tabpanel"
        aria-labelledby="teacher-tab-students"
      >
        <section class="panel card">
          <div class="portal-section-header" style="align-items:flex-start; gap:0.75rem;">
            <div>
              <p class="portal-section-title" style="margin-bottom:0.35rem">Gesti√≥ d'alumnat</p>
              <h2 style="margin:0">Edita perfils i grups</h2>
              <p class="portal-muted" style="margin-top:0.5rem;">Organitza els grups i crea nous accessos sense sortir del portal.</p>
            </div>
            <button id="studentAdminRefresh" type="button" class="btn-secondary">Actualitza alumnes</button>
          </div>

          <form id="studentCreateForm" class="portal-form portal-form--inline" autocomplete="off">
            <label>
              <span class="portal-field-label">Nom complet</span>
              <input class="input" name="full_name" type="text" required placeholder="Nom i cognoms" autocomplete="off" />
            </label>
            <label>
              <span class="portal-field-label">Correu electr√≤nic</span>
              <input class="input" name="email" type="email" required placeholder="alumne@centre.cat" autocomplete="off" />
            </label>
            <label>
              <span class="portal-field-label">Contrasenya temporal</span>
              <input class="input" name="password" type="text" minlength="6" required placeholder="M√≠nim 6 car√†cters" autocomplete="off" />
            </label>
            <label data-admin-group-field>
              <span class="portal-field-label">Grup (opcional)</span>
              <input class="input" name="group_name" type="text" placeholder="Per exemple: 3rA" list="studentGroupSuggestions" autocomplete="off" />
            </label>
            <div class="portal-actions portal-actions--compact">
              <button class="btn-primary" type="submit">Crear alumne</button>
            </div>
          </form>

          <div class="portal-admin-feedback">
            <div id="studentAdminFeedback" class="portal-success hidden" role="status" aria-live="polite"></div>
            <div id="studentAdminError" class="portal-error hidden" role="alert"></div>
          </div>

          <div id="studentAdminToolbar" class="portal-student-admin-toolbar">
            <div>
              <p class="portal-section-title" style="margin-bottom:0.35rem">Filtra per grup</p>
              <div id="studentAdminFilter" class="portal-group-chips" role="group" aria-label="Filtra alumnes per grup"></div>
            </div>
          </div>

          <div id="studentAdminList" class="portal-student-admin-list" aria-live="polite"></div>
          <datalist id="studentGroupSuggestions"></datalist>
        </section>
      </section>
    </section>

    <section id="studentPanel" class="portal-tabpanel hidden" data-tab-panel="student" role="tabpanel" aria-labelledby="tab-student">
      <section id="studentView" class="panel card hidden">
        <h2>Panell d'alumne/a</h2>
        <p class="portal-muted">Les proves arriben amb una presentaci√≥ simplificada i un bot√≥ neon per comen√ßar. Quan finalitzis, la nota s'enviar√† sola a la docent.</p>
        <div id="studentAssignmentList" class="portal-list list" aria-live="polite"></div>
      </section>
    </section>
  </main>

  <script type="module" src="./supabase-portal.js"></script>
</body>
</html>
