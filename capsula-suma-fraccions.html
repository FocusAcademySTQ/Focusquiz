<!DOCTYPE html>
<html lang="ca">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>FocusQuiz ¬∑ C√†psula ¬∑ Suma de fraccions (denominadors diferents)</title>
<meta name="description" content="C√†psula visual i seq√ºencial per aprendre a sumar fraccions amb denominadors diferents: MCM, equival√®ncies, suma i simplificaci√≥. Inclou pr√†ctica guiada i joc final." />
<style>
:root{
  --bg:#f9fafb; --card:#fff; --ink:#0f172a; --muted:#64748b; --line:#e2e8f0;
  --brand:#93c5fd; --brand2:#a7f3d0; --brand3:#fbcfe8;
  --ok:#16a34a; --bad:#dc2626; --shadow:0 10px 30px rgba(2,8,23,.08);
}
*{box-sizing:border-box}
body{
  margin:0;font:17px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
  color:var(--ink);background:var(--bg);
  background-image:linear-gradient(transparent 23px,var(--line) 24px),linear-gradient(90deg,transparent 23px,var(--line) 24px);
  background-size:24px 24px,24px 24px;
}
section{max-width:900px;margin:0 auto;padding:22px;display:grid;gap:24px}
.card{
  background:var(--card);border:1px solid var(--line);border-radius:18px;
  box-shadow:var(--shadow);padding:22px;animation:fadein .4s ease both
}
h1,h2{margin:6px 0 12px} h3{margin-top:8px}
.muted{color:var(--muted)}
.btn{
  border:0;border-radius:12px;padding:12px 20px;
  background:linear-gradient(135deg,var(--brand),var(--brand3));
  color:#0b1220;font-weight:600;cursor:pointer;
  box-shadow:0 4px 14px rgba(2,8,23,.08);
  transition:.25s transform,.25s box-shadow;
}
.btn:hover{transform:translateY(-2px);box-shadow:0 8px 18px rgba(2,8,23,.12)}
.btn:disabled{opacity:.45;cursor:not-allowed}
.row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.frac{display:inline-grid;grid-template-rows:auto auto;line-height:1}
.frac>i{height:2px;background:#111827;border-radius:2px;margin:2px 0}
.input{
  padding:9px 12px;border:1px solid var(--line);border-radius:10px;width:110px;text-align:center
}
.ok{color:var(--ok)} .bad{color:var(--bad)} .hidden{display:none}
.pill{display:inline-block;padding:5px 10px;border-radius:999px;
  border:1px solid var(--line);background:#fff;color:var(--muted)}
.progress{height:8px;background:var(--line);border-radius:999px;overflow:hidden;margin:6px 0 10px}
.bar{height:8px;width:0;background:linear-gradient(90deg,var(--brand),var(--brand2));transition:.3s width}
.fade{opacity:0;transform:translateY(8px);animation:fade .5s forwards}
@keyframes fade{to{opacity:1;transform:none}}
@keyframes fadein{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:none}}
svg{max-width:100%;height:auto}
.list{display:grid;grid-template-columns:1fr auto 1fr;gap:8px;align-items:center}
</style>
</head>
<body>
<section id="capsule">

<!-- 1) Objectiu -->
<article class="card" id="blk-1">
  <h1>üéØ Objectiu did√†ctic</h1>
  <p>Aprendr√†s a <b>sumar fraccions amb denominadors diferents</b> seguint quatre passos: <b>MCM</b> ‚Üí <b>equival√®ncies</b> ‚Üí <b>suma</b> ‚Üí <b>simplificaci√≥</b>.</p>
  <button class="btn" id="start">Comen√ßa</button>
</article>

<!-- 2) Introducci√≥ visual -->
<article class="card hidden" id="blk-2">
  <h2>üîπ Introducci√≥ visual</h2>
  <p class="muted">Veurem com transformar <b>1/2 + 1/3</b> a fraccions equivalents amb denominador com√∫ (6) i sumar-les.</p>
  <div id="viz" class="fade"></div>
  <div class="row" style="justify-content:space-between;margin-top:8px">
    <span class="pill">Exemple: 1/2 + 1/3</span>
    <div class="row">
      <button class="btn" id="btnShowMCM">Mostra MCM</button>
      <button class="btn" id="btnShowSum" disabled>Mostra la suma</button>
    </div>
  </div>
</article>

<!-- 3) Explicaci√≥ guiada -->
<article class="card hidden" id="blk-3">
  <h2>üß† Explicaci√≥ guiada</h2>
  <div class="progress"><div class="bar" id="bar"></div></div>
  <ol id="guide" class="fade" style="margin:0 0 0 18px"></ol>
  <button class="btn" id="nextStep">Seg√ºent pas</button>
</article>

<!-- 4) Pr√†ctica guiada -->
<article class="card hidden" id="blk-4">
  <h2>‚úèÔ∏è Pr√†ctica guiada</h2>
  <p class="muted">Completa els passos. Quan ho facis b√©, desbloquejar√†s el seg√ºent.</p>

  <div id="p1" class="fade">
    <h3>Pas 1 ¬∑ Troba el MCM (denominadors 2 i 3)</h3>
    <div class="row">
      <input id="mcm" class="input" placeholder="MCM" />
      <button class="btn" id="mcmChk">Comprova</button><span id="mcmMsg" class="muted"></span>
    </div>
    <small class="muted">M√∫ltiples de 2 ‚Üí 2,4,6,8‚Ä¶ | de 3 ‚Üí 3,6,9‚Ä¶</small>
  </div>

  <div id="p2" class="hidden">
    <h3>Pas 2 ¬∑ Equival√®ncies</h3>
    <div class="row list">
      <div>1/2 ‚Üí</div>
      <div class="row"><input id="a2n" class="input" placeholder="numerador" /><span class="frac"><b></b><i></i><b>6</b></span></div>
      <span id="eqMsg1" class="muted"></span>
    </div>
    <div class="row list">
      <div>1/3 ‚Üí</div>
      <div class="row"><input id="c2n" class="input" placeholder="numerador" /><span class="frac"><b></b><i></i><b>6</b></span></div>
      <span id="eqMsg2" class="muted"></span>
    </div>
    <button class="btn" id="eqChk">Comprova</button><span id="eqMsg" class="muted"></span>
  </div>

  <div id="p3" class="hidden">
    <h3>Pas 3 ¬∑ Suma</h3>
    <div class="row">
      <span class="frac"><b>3</b><i></i><b>6</b></span> + <span class="frac"><b>2</b><i></i><b>6</b></span> =
      <div class="frac"><b><input id="sumN" class="input" placeholder="numerador" /></b><i></i><b><input id="sumD" class="input" value="6" readonly /></b></div>
      <button class="btn" id="sumChk">Comprova</button><span id="sumMsg" class="muted"></span>
    </div>
  </div>

  <div id="p4" class="hidden">
    <h3>Pas 4 ¬∑ Resultat final</h3>
    <div class="row">
      <span class="pill">Resultat: 5/6</span>
      <span class="ok" id="simpMsg">Ja est√† simplificat ‚úÖ</span>
    </div>
    <div class="row" style="margin-top:8px"><button class="btn" id="toGame">Anar al joc</button></div>
  </div>
</article>

<!-- 5) Joc interactiu -->
<article class="card hidden" id="blk-5">
  <h2>üéÆ Joc de fraccions</h2>
  <p class="muted">Escull la resposta correcta. Les operacions canvien cada vegada!</p>
  <div id="game" class="fade"></div>
</article>

<!-- 6) Resum -->
<article class="card hidden" id="blk-6">
  <h2>üìò Resum</h2>
  <ul>
    <li>1Ô∏è‚É£ Troba el <b>MCM</b> dels denominadors.</li>
    <li>2Ô∏è‚É£ Converteix a fraccions equivalents.</li>
    <li>3Ô∏è‚É£ <b>Suma</b> els numeradors, mantenint el denominador.</li>
    <li>4Ô∏è‚É£ <b>Simplifica</b> si √©s possible.</li>
  </ul>
  <button class="btn" id="restart">Torna a comen√ßar</button>
</article>

</section>

<script>
const $=id=>document.getElementById(id);
const gcd=(a,b)=>b?gcd(b,a%b):a;
function drawPie(cx,cy,r,parts,fill,color){
  let out='',tau=Math.PI*2,off=-Math.PI/2;
  for(let i=0;i<parts;i++){
    const a0=off+i*(tau/parts),a1=off+(i+1)*(tau/parts);
    const x0=cx+r*Math.cos(a0),y0=cy+r*Math.sin(a0),x1=cx+r*Math.cos(a1),y1=cy+r*Math.sin(a1);
    const large=(a1-a0)>Math.PI?1:0;
    out+=`<path d="M${cx} ${cy}L${x0} ${y0}A${r} ${r} 0 ${large} 1 ${x1} ${y1}Z" fill="${i<fill?color:'#e5e7eb'}" stroke="#94a3b8"/>`;
  }
  return out;
}

// Ordre de blocs
const order=['blk-1','blk-2','blk-3','blk-4','blk-5','blk-6'];
function openNext(id){const i=order.indexOf(id);if(i<order.length-1){const n=order[i+1];$(n).classList.remove('hidden');$(n).scrollIntoView({behavior:'smooth'});}}

// Introducci√≥ visual
function renderIntro(){
  const svg=`<svg viewBox="0 0 820 240">
    <g>${drawPie(150,90,70,2,1,'#93c5fd')}<text x="150" y="190" text-anchor="middle" fill="#334155">1/2</text></g>
    <g>${drawPie(390,90,70,3,1,'#fbcfe8')}<text x="390" y="190" text-anchor="middle" fill="#334155">1/3</text></g>
    <text x="270" y="100" font-size="26" text-anchor="middle" fill="#0f172a">+</text>
    <g id="zone2"></g>
  </svg>`;
  $('viz').innerHTML=svg;
}
function showMCM(){
  const zone=`<g>${drawPie(150,160,60,6,3,'#a7f3d0')}<text x="150" y="230" text-anchor="middle">3/6</text></g>
  <g>${drawPie(390,160,60,6,2,'#c7d2fe')}<text x="390" y="230" text-anchor="middle">2/6</text></g>`;
  $('viz').querySelector('#zone2').innerHTML=zone; $('btnShowSum').disabled=false;
}
function showSum(){
  $('viz').querySelector('#zone2').innerHTML+=`<g>${drawPie(650,160,70,6,5,'#fde68a')}<text x="650" y="230" text-anchor="middle">3/6+2/6=5/6</text></g>`;
  openNext('blk-2');
}

// Explicaci√≥ guiada
const steps=[
  {t:`Denominadors: 2 i 3 ‚Üí MCM = 6`,`v`:`M√∫ltiples: 2‚Üí2,4,<b>6</b> ¬∑ 3‚Üí3,<b>6</b>`},
  {t:`Equival√®ncies: 1/2 ‚Üí 3/6 i 1/3 ‚Üí 2/6`,`v`:`1/2√ó3=3/6 ¬∑ 1/3√ó2=2/6`},
  {t:`Suma: 3/6 + 2/6 = 5/6`,`v`:`Suma nom√©s el numerador.`},
  {t:`Simplificaci√≥`,`v`:`MCD(5,6)=1 ‚Üí ja simplificat ‚úÖ`}
];
let gi=0;const bar=$('bar');
function addGuideStep(){
  if(gi>=steps.length){$('nextStep').disabled=true;openNext('blk-3');return;}
  const li=document.createElement('li');li.className='fade';
  li.innerHTML=`<b>${steps[gi].t}</b><div class="mini muted">${steps[gi].v}</div>`;
  $('guide').appendChild(li);gi++;bar.style.width=(gi/steps.length*100)+'%';
}

// Pr√†ctica
function checkMCM(){const v=$('mcm').value.trim();if(v==='6'){$('mcmMsg').innerHTML='<span class="ok">Correcte!</span>';$('p2').classList.remove('hidden');}else{$('mcmMsg').innerHTML='<span class="bad">Prova amb 6.</span>';}}
function checkEq(){
  const a=$('a2n').value.trim(),c=$('c2n').value.trim();
  const ok1=(a==='3'),ok2=(c==='2');
  $('eqMsg1').innerHTML=ok1?'<span class="ok">1/2=3/6</span>':'<span class="bad">√ó3</span>';
  $('eqMsg2').innerHTML=ok2?'<span class="ok">1/3=2/6</span>':'<span class="bad">√ó2</span>';
  if(ok1&&ok2){$('eqMsg').innerHTML='<span class="ok">Perfecte!</span>';$('p3').classList.remove('hidden');}
}
function checkSum(){
  const n=$('sumN').value.trim();const ok=(n==='5');
  $('sumMsg').innerHTML=ok?'<span class="ok">Correcte: 5/6 ‚úÖ</span>':'<span class="bad">Revisa: 3+2=5.</span>';
  if(ok){$('p4').classList.remove('hidden');}
}

// Joc amb varietat
const exercises=[
  {q:'2/5 + 1/10',opts:['3/10','1/2','7/10'],ok:1,exp:'2/5=4/10 ‚Üí 4/10+1/10=5/10=1/2'},
  {q:'1/4 + 1/6',opts:['2/10','5/12','7/24'],ok:1,exp:'MCM=12 ‚Üí 3/12+2/12=5/12'},
  {q:'3/8 + 1/4',opts:['1/2','5/12','7/16'],ok:2,exp:'1/4=2/8 ‚Üí 3/8+2/8=5/8'}
];
function renderGame(){
  const ex=exercises[Math.floor(Math.random()*exercises.length)];
  let html=`<p>Resol: <b>${ex.q}</b></p><div class="row">`;
  ex.opts.forEach((o,i)=>{
    html+=`<button class="btn" data-i="${i}">${o}</button>`;
  });
  html+=`</div><p id="gMsg" class="muted"></p>`;
  $('game').innerHTML=html;

  // Gesti√≥ respostes
  $('game').querySelectorAll('[data-i]').forEach(btn=>{
    btn.onclick=()=>{
      const i=parseInt(btn.dataset.i);
      if(i===ex.ok){
        $('gMsg').innerHTML=`<span class="ok">‚úÖ Correcte! ${ex.exp}</span>`;
        btn.style.background='linear-gradient(135deg,#bbf7d0,#86efac)';
        setTimeout(()=>openNext('blk-5'),900);
      } else {
        $('gMsg').innerHTML=`<span class="bad">‚ùå Incorrecte. Torna-ho a provar!</span>`;
        btn.style.background='linear-gradient(135deg,#fecaca,#f87171)';
      }
    };
  });
}

// ‚Äî‚Äî‚Äî Esdeveniments ‚Äî‚Äî‚Äî
$('start').onclick=()=>{ $('blk-2').classList.remove('hidden'); renderIntro(); };
$('btnShowMCM').onclick=showMCM;
$('btnShowSum').onclick=showSum;
$('nextStep').onclick=addGuideStep;
$('mcmChk').onclick=checkMCM;
$('eqChk').onclick=checkEq;
$('sumChk').onclick=checkSum;
$('toGame').onclick=()=>{ $('blk-5').classList.remove('hidden'); renderGame(); };
$('restart').onclick=()=>location.reload();
</script>
</body>
</html>

